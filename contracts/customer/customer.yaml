openapi: 3.0.3
info:
  title: RNT-ALPH Customer API
  description: Customer-facing API for the car rental platform
  version: 1.0.0
  contact:
    name: RNT-ALPH Team

servers:
  - url: http://localhost:9847/api/v1/customer
    description: Local development server
  - url: https://api.rnt-alph.com/v1/customer
    description: Production server

tags:
  - name: Vehicles
    description: Vehicle search and browsing operations
  - name: Companies
    description: Company information and details
  - name: Branches
    description: Branch and vehicle availability operations
  - name: Reservations
    description: Vehicle reservation operations for customers
  - name: Authentication
    description: User authentication and profile operations
  - name: Profile
    description: Customer profile management operations

paths:
  /auth/me:
    get:
      tags:
        - Authentication
      summary: Get current authenticated user profile
      description: |
        Returns the profile information of the currently authenticated user.

        **Authentication required**: This endpoint requires a valid JWT bearer token.
      operationId: getCurrentUser
      security:
        - bearerAuth: []
      responses:
        '200':
          description: User profile retrieved successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/CustomerProfile'
              example:
                userId: "auth0|507f1f77bcf86cd799439011"
                email: "jan.kowalski@example.com"
                emailVerified: true
                name: "Jan Kowalski"
                pictureUrl: "https://example.com/profile/jan-kowalski.jpg"

        '401':
          description: Not authenticated - missing or invalid token
          content:
            application/json:
              schema:
                $ref: '../shared/schemas/common.yaml#/ErrorResponse'
              example:
                error: "Unauthorized"
                message: "Authentication required"
                timestamp: "2024-11-15T12:00:00Z"

        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: '../shared/schemas/common.yaml#/ErrorResponse'

  /me/data-export:
    get:
      tags:
        - Authentication
      summary: Export all personal data (GDPR)
      description: |
        Returns all personal data associated with the authenticated user in JSON format.
        This endpoint supports GDPR Article 20 (Right to Data Portability).

        **Authentication required**: This endpoint requires a valid JWT bearer token.

        **Data included**:
        - User profile information
        - All reservations (by user ID or matching email)
        - Phone verification records linked to reservations
        - Audit events where user was the actor
      operationId: exportUserData
      security:
        - bearerAuth: []
      responses:
        '200':
          description: User data exported successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/UserDataExportResponse'
              example:
                exportedAt: "2024-12-15T10:00:00Z"
                profile:
                  id: "tcrn:user:507f1f77-bcf8-6cd7-9943-9011aabbccdd"
                  firebaseUid: "firebase_507f1f77bcf86cd799439011"
                  email: "jan.kowalski@example.com"
                  emailVerified: true
                  name: "Jan Kowalski"
                  userType: "CUSTOMER"
                  createdAt: "2024-01-15T10:00:00Z"
                reservations:
                  - id: "tcrn:reservation:aabbccdd-1122-3344-5566-778899aabbcc"
                    confirmationCode: "ABC12345"
                    status: "confirmed"
                    pickupDate: "2024-12-20T10:00:00Z"
                    returnDate: "2024-12-27T10:00:00Z"
                    driver:
                      firstName: "Jan"
                      lastName: "Kowalski"
                      email: "jan.kowalski@example.com"
                      phone: "+48 123 456 789"
                phoneVerifications: []
                auditEvents:
                  - id: "tcrn:audit:11223344-5566-7788-99aa-bbccddeeff00"
                    operation: "CREATE"
                    resourceType: "RESERVATION"
                    createdAt: "2024-12-15T10:00:00Z"

        '401':
          description: Not authenticated - missing or invalid token
          content:
            application/json:
              schema:
                $ref: '../shared/schemas/common.yaml#/ErrorResponse'
              example:
                error: "Unauthorized"
                message: "Authentication required"
                timestamp: "2024-11-15T12:00:00Z"

        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: '../shared/schemas/common.yaml#/ErrorResponse'

  /me:
    delete:
      tags:
        - Authentication
      summary: Delete user account (GDPR)
      description: |
        Permanently deletes the authenticated user's account and anonymizes their personal data.
        This endpoint supports GDPR Article 17 (Right to Erasure / Right to be Forgotten).

        **Authentication required**: This endpoint requires a valid JWT bearer token.

        **What happens**:
        - User profile is deleted from the database
        - Reservation personal data (driver info) is anonymized but records kept for business/legal compliance
        - Phone verification records are deleted
        - Audit events are anonymized but kept for compliance audit trail

        **Note**: This action is irreversible. The user will need to re-register to use the service again.
        Auth0 account is not deleted - user should manage that separately in Auth0.
      operationId: deleteUserAccount
      security:
        - bearerAuth: []
      responses:
        '200':
          description: Account deleted successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AccountDeletionResponse'
              example:
                message: "Your account has been successfully deleted. All personal data has been removed or anonymized."
                deletedAt: "2024-12-15T10:00:00Z"

        '401':
          description: Not authenticated - missing or invalid token
          content:
            application/json:
              schema:
                $ref: '../shared/schemas/common.yaml#/ErrorResponse'
              example:
                error: "Unauthorized"
                message: "Authentication required"
                timestamp: "2024-11-15T12:00:00Z"

        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: '../shared/schemas/common.yaml#/ErrorResponse'

  /vehicles:
    get:
      tags:
        - Vehicles
      summary: Search vehicles across all branches
      description: |
        Search for vehicles across all branches in the system.
        Filter by city, availability dates, and vehicle characteristics.
      operationId: searchVehicles
      parameters:
        # Location filtering
        - $ref: '../shared/parameters/common.yaml#/CityParam'
        - $ref: '../shared/parameters/common.yaml#/BranchIdQueryParam'
        # Availability filtering
        - $ref: '../shared/parameters/common.yaml#/PickupDateParam'
        - $ref: '../shared/parameters/common.yaml#/ReturnDateParam'
        # Vehicle filters
        - $ref: '../shared/parameters/common.yaml#/VehicleTypeParam'
        - $ref: '../shared/parameters/common.yaml#/TransmissionParam'
        - $ref: '../shared/parameters/common.yaml#/FuelTypeParam'
        - $ref: '../shared/parameters/common.yaml#/MakeParam'
        - $ref: '../shared/parameters/common.yaml#/ModelParam'
        - $ref: '../shared/parameters/common.yaml#/MinSeatsParam'
        - $ref: '../shared/parameters/common.yaml#/MaxSeatsParam'
        - $ref: '../shared/parameters/common.yaml#/MinPriceParam'
        - $ref: '../shared/parameters/common.yaml#/MaxPriceParam'
        - $ref: '../shared/parameters/common.yaml#/MaxPricePerDayParam'
        # Pagination
        - $ref: '../shared/parameters/common.yaml#/PageParam'
        - $ref: '../shared/parameters/common.yaml#/SizeParam'
        - $ref: '../shared/parameters/common.yaml#/SortParam'

      responses:
        '200':
          description: Successfully retrieved vehicles
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/VehicleSearchResponse'
              example:
                vehicles:
                  - id: "tcrn:vehicle:3fa85f64-5717-4562-b3fc-2c963f66afa6"
                    make: "Toyota"
                    model: "RAV4"
                    year: 2023
                    vehicleType: "suv"
                    transmission: "automatic"
                    fuelType: "hybrid"
                    seats: 5
                    pricePerDay: 250.00
                    currency: "PLN"
                    mainImage: "https://cdn.example.com/vehicles/rav4.jpg"
                    available: true
                    branch:
                      id: "tcrn:branch:22222222-2222-2222-2222-222222222222"
                      name: "Warsaw Downtown"
                      city: "Warsaw"
                    company:
                      id: "tcrn:company:11111111-1111-1111-1111-111111111111"
                      name: "Rent-A-Car Poland"
                  - id: "tcrn:vehicle:4fa85f64-5717-4562-b3fc-2c963f66afa7"
                    make: "BMW"
                    model: "X5"
                    year: 2024
                    vehicleType: "suv"
                    transmission: "automatic"
                    fuelType: "diesel"
                    seats: 7
                    pricePerDay: 450.00
                    currency: "PLN"
                    mainImage: "https://cdn.example.com/vehicles/bmw-x5.jpg"
                    available: true
                    branch:
                      id: "tcrn:branch:33333333-3333-3333-3333-333333333333"
                      name: "Warsaw Airport"
                      city: "Warsaw"
                    company:
                      id: "tcrn:company:44444444-4444-4444-4444-444444444444"
                      name: "Premium Car Rental"
                pagination:
                  currentPage: 0
                  pageSize: 20
                  totalElements: 45
                  totalPages: 3

        '400':
          description: Bad request - invalid parameters
          content:
            application/json:
              schema:
                $ref: '../shared/schemas/common.yaml#/ErrorResponse'
              examples:
                missingReturnDate:
                  summary: Return date required when pickup date provided
                  value:
                    error: "Bad Request"
                    message: "returnDate is required when pickupDate is provided"
                    timestamp: "2024-11-15T12:00:00Z"
                invalidDateRange:
                  summary: Invalid date range
                  value:
                    error: "Bad Request"
                    message: "returnDate must be after pickupDate"
                    timestamp: "2024-11-15T12:00:00Z"

        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: '../shared/schemas/common.yaml#/ErrorResponse'

  /vehicles/{vehicleId}:
    get:
      tags:
        - Vehicles
      summary: Get vehicle details by ID
      description: |
        Returns detailed information about a specific vehicle,
        including full specifications, images, branch and company information.
      operationId: getVehicleById
      parameters:
        - name: vehicleId
          in: path
          required: true
          description: Unique identifier of the vehicle (prefixed format)
          schema:
            $ref: '../shared/schemas/common.yaml#/VehicleId'

      responses:
        '200':
          description: Successfully retrieved vehicle details
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/VehicleDetails'
              example:
                id: "tcrn:vehicle:3fa85f64-5717-4562-b3fc-2c963f66afa6"
                make: "Toyota"
                model: "RAV4"
                year: 2023
                vehicleType: "suv"
                transmission: "automatic"
                fuelType: "hybrid"
                seats: 5
                pricePerDay: 250.00
                currency: "PLN"
                mainImage: "https://cdn.example.com/vehicles/rav4.jpg"
                imageUrls:
                  - "https://cdn.example.com/vehicles/rav4-1.jpg"
                  - "https://cdn.example.com/vehicles/rav4-2.jpg"
                available: true
                description: "Spacious and fuel-efficient SUV, perfect for family trips"
                branch:
                  id: "tcrn:branch:22222222-2222-2222-2222-222222222222"
                  name: "Warsaw Downtown"
                  city: "Warsaw"
                  address: "ul. Marszałkowska 1, 00-001 Warszawa"
                company:
                  id: "tcrn:company:11111111-1111-1111-1111-111111111111"
                  name: "Rent-A-Car Poland"

        '404':
          description: Vehicle not found
          content:
            application/json:
              schema:
                $ref: '../shared/schemas/common.yaml#/ErrorResponse'
              example:
                error: "Not Found"
                message: "Vehicle with id tcrn:vehicle:3fa85f64-5717-4562-b3fc-2c963f66afa6 does not exist"
                timestamp: "2024-11-15T12:00:00Z"

        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: '../shared/schemas/common.yaml#/ErrorResponse'

  /companies/{companyId}:
    get:
      tags:
        - Companies
      summary: Get company details
      description: |
        Returns detailed information about a specific rental company,
        including contact information, address, opening hours, and ratings.
      operationId: getCompanyDetails
      parameters:
        - name: companyId
          in: path
          required: true
          description: Unique identifier of the company (prefixed format)
          schema:
            $ref: '../shared/schemas/common.yaml#/CompanyId'

      responses:
        '200':
          description: Successfully retrieved company details
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/CompanyDetails'
              example:
                id: "tcrn:company:11111111-1111-1111-1111-111111111111"
                name: "Rent-A-Car Poland"
                description: "Leading car rental company in Poland with over 20 years of experience"
                logoUrl: "https://cdn.example.com/logos/rent-a-car-poland.png"
                websiteUrl: "https://www.rentacar.pl"
                nip: "1234567890"
                regon: "123456789"
                phone: "+48 22 123 45 67"
                email: "contact@rentacar.pl"
                address:
                  street: "ul. Marszałkowska 1"
                  city: "Warszawa"
                  postalCode: "00-001"
                  country: "Poland"
                openingHours:
                  - dayOfWeek: "MONDAY"
                    openTime: "08:00"
                    closeTime: "18:00"
                    closed: false
                  - dayOfWeek: "SATURDAY"
                    openTime: "09:00"
                    closeTime: "14:00"
                    closed: false
                  - dayOfWeek: "SUNDAY"
                    closed: true
                rating: 45
                reviewCount: 127

        '404':
          description: Company not found
          content:
            application/json:
              schema:
                $ref: '../shared/schemas/common.yaml#/ErrorResponse'
              example:
                error: "Not Found"
                message: "Company with id tcrn:company:11111111-1111-1111-1111-111111111111 does not exist"
                timestamp: "2024-11-15T12:00:00Z"

        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: '../shared/schemas/common.yaml#/ErrorResponse'

  /companies/{companyId}/vehicles:
    get:
      tags:
        - Vehicles
      summary: Get all vehicles for a specific company
      description: |
        Returns all vehicles belonging to a specific rental company across all their branches.
        Optionally filter by availability dates and vehicle characteristics.
      operationId: getVehiclesByCompany
      parameters:
        # Path parameter
        - name: companyId
          in: path
          required: true
          description: Unique identifier of the company (prefixed format)
          schema:
            $ref: '../shared/schemas/common.yaml#/CompanyId'
        # Availability filtering
        - $ref: '../shared/parameters/common.yaml#/PickupDateParam'
        - $ref: '../shared/parameters/common.yaml#/ReturnDateParam'
        # Vehicle filters
        - $ref: '../shared/parameters/common.yaml#/VehicleTypeParam'
        - $ref: '../shared/parameters/common.yaml#/TransmissionParam'
        - $ref: '../shared/parameters/common.yaml#/FuelTypeParam'
        - $ref: '../shared/parameters/common.yaml#/MakeParam'
        - $ref: '../shared/parameters/common.yaml#/ModelParam'
        - $ref: '../shared/parameters/common.yaml#/MinSeatsParam'
        - $ref: '../shared/parameters/common.yaml#/MaxSeatsParam'
        - $ref: '../shared/parameters/common.yaml#/MinPriceParam'
        - $ref: '../shared/parameters/common.yaml#/MaxPriceParam'
        - $ref: '../shared/parameters/common.yaml#/MaxPricePerDayParam'
        # Location filtering (within company)
        - $ref: '../shared/parameters/common.yaml#/BranchIdQueryParam'
        - $ref: '../shared/parameters/common.yaml#/CityParam'
        # Pagination
        - $ref: '../shared/parameters/common.yaml#/PageParam'
        - $ref: '../shared/parameters/common.yaml#/SizeParam'
        - $ref: '../shared/parameters/common.yaml#/SortParam'

      responses:
        '200':
          description: Successfully retrieved vehicles
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/CompanyVehicleListResponse'
              example:
                vehicles:
                  - id: "tcrn:vehicle:5fa85f64-5717-4562-b3fc-2c963f66afa8"
                    make: "Toyota"
                    model: "RAV4"
                    year: 2023
                    vehicleType: "suv"
                    transmission: "automatic"
                    fuelType: "hybrid"
                    seats: 5
                    pricePerDay: 250.00
                    currency: "PLN"
                    mainImage: "https://cdn.example.com/vehicles/rav4.jpg"
                    available: true
                    branch:
                      id: "tcrn:branch:22222222-2222-2222-2222-222222222222"
                      name: "Warsaw Downtown"
                      city: "Warsaw"
                  - id: "tcrn:vehicle:6fa85f64-5717-4562-b3fc-2c963f66afa9"
                    make: "Toyota"
                    model: "Corolla"
                    year: 2023
                    vehicleType: "sedan"
                    transmission: "automatic"
                    fuelType: "hybrid"
                    seats: 5
                    pricePerDay: 150.00
                    currency: "PLN"
                    mainImage: "https://cdn.example.com/vehicles/corolla.jpg"
                    available: true
                    branch:
                      id: "tcrn:branch:33333333-3333-3333-3333-333333333333"
                      name: "Warsaw Airport"
                      city: "Warsaw"
                company:
                  id: "tcrn:company:11111111-1111-1111-1111-111111111111"
                  name: "Rent-A-Car Poland"
                pagination:
                  currentPage: 0
                  pageSize: 20
                  totalElements: 45
                  totalPages: 3

        '400':
          description: Bad request - invalid parameters
          content:
            application/json:
              schema:
                $ref: '../shared/schemas/common.yaml#/ErrorResponse'

        '404':
          description: Company not found
          content:
            application/json:
              schema:
                $ref: '../shared/schemas/common.yaml#/ErrorResponse'
              example:
                error: "Not Found"
                message: "Company with id tcrn:company:11111111-1111-1111-1111-111111111111 does not exist"
                timestamp: "2024-11-15T12:00:00Z"

        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: '../shared/schemas/common.yaml#/ErrorResponse'

  /branches/{branchId}/vehicles:
    get:
      tags:
        - Vehicles
        - Branches
      summary: Get vehicles for a specific branch
      description: |
        Returns a list of vehicles available at the specified branch.
        Optionally filter by availability dates and vehicle characteristics.
      operationId: getVehiclesByBranch
      parameters:
        # Path parameter
        - name: branchId
          in: path
          required: true
          description: Unique identifier of the branch (prefixed format)
          schema:
            $ref: '../shared/schemas/common.yaml#/BranchId'
        # Availability filtering
        - $ref: '../shared/parameters/common.yaml#/PickupDateParam'
        - $ref: '../shared/parameters/common.yaml#/ReturnDateParam'
        # Vehicle filters
        - $ref: '../shared/parameters/common.yaml#/VehicleTypeParam'
        - $ref: '../shared/parameters/common.yaml#/TransmissionParam'
        - $ref: '../shared/parameters/common.yaml#/FuelTypeParam'
        - $ref: '../shared/parameters/common.yaml#/MakeParam'
        - $ref: '../shared/parameters/common.yaml#/ModelParam'
        - $ref: '../shared/parameters/common.yaml#/MinSeatsParam'
        - $ref: '../shared/parameters/common.yaml#/MaxSeatsParam'
        - $ref: '../shared/parameters/common.yaml#/MinPriceParam'
        - $ref: '../shared/parameters/common.yaml#/MaxPriceParam'
        - $ref: '../shared/parameters/common.yaml#/MaxPricePerDayParam'
        # Pagination
        - $ref: '../shared/parameters/common.yaml#/PageParam'
        - $ref: '../shared/parameters/common.yaml#/SizeParam'
        - $ref: '../shared/parameters/common.yaml#/SortParam'

      responses:
        '200':
          description: Successfully retrieved vehicles
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/VehicleListResponse'
              example:
                vehicles:
                  - id: "tcrn:vehicle:7fa85f64-5717-4562-b3fc-2c963f66afaa"
                    make: "Toyota"
                    model: "RAV4"
                    year: 2023
                    vehicleType: "suv"
                    transmission: "automatic"
                    fuelType: "hybrid"
                    seats: 5
                    pricePerDay: 250.00
                    currency: "PLN"
                    mainImage: "https://cdn.example.com/vehicles/rav4.jpg"
                    available: true
                branch:
                  id: "tcrn:branch:22222222-2222-2222-2222-222222222222"
                  name: "Warsaw Downtown"
                  city: "Warsaw"
                  address: "ul. Marszałkowska 1"
                company:
                  id: "tcrn:company:11111111-1111-1111-1111-111111111111"
                  name: "Rent-A-Car Poland"
                pagination:
                  currentPage: 0
                  pageSize: 20
                  totalElements: 8
                  totalPages: 1

        '400':
          description: Bad request - invalid parameters
          content:
            application/json:
              schema:
                $ref: '../shared/schemas/common.yaml#/ErrorResponse'
              examples:
                missingReturnDate:
                  summary: Return date required when pickup date provided
                  value:
                    error: "Bad Request"
                    message: "returnDate is required when pickupDate is provided"
                    timestamp: "2024-11-15T12:00:00Z"
                invalidDateRange:
                  summary: Invalid date range
                  value:
                    error: "Bad Request"
                    message: "returnDate must be after pickupDate"
                    timestamp: "2024-11-15T12:00:00Z"

        '404':
          description: Branch not found
          content:
            application/json:
              schema:
                $ref: '../shared/schemas/common.yaml#/ErrorResponse'
              example:
                error: "Not Found"
                message: "Branch with id tcrn:branch:22222222-2222-2222-2222-222222222222 does not exist"
                timestamp: "2024-11-15T12:00:00Z"

        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: '../shared/schemas/common.yaml#/ErrorResponse'

  # ==================== RESERVATIONS ====================
  /reservations/me:
    get:
      tags:
        - Reservations
      summary: Get authenticated user's reservations
      description: |
        Returns a paginated list of reservations belonging to the authenticated user.

        **Authentication required**: This endpoint requires a valid JWT bearer token.

        **Pagination**: Use `page` and `size` parameters to control the number of results.
      operationId: getMyReservations
      security:
        - bearerAuth: []
      parameters:
        - name: page
          in: query
          description: Page number (zero-indexed)
          required: false
          schema:
            type: integer
            default: 0
            minimum: 0
          example: 0
        - name: size
          in: query
          description: Number of items per page
          required: false
          schema:
            type: integer
            default: 20
            minimum: 1
            maximum: 100
          example: 20

      responses:
        '200':
          description: User's reservations retrieved successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ReservationListResponse'
              example:
                reservations:
                  - id: "tcrn:reservation:aabbccdd-1122-3344-5566-778899aabbcc"
                    status: "confirmed"
                    pickupDate: "2024-12-20T10:00:00Z"
                    returnDate: "2024-12-27T10:00:00Z"
                    driver:
                      firstName: "Jan"
                      lastName: "Kowalski"
                      email: "jan.kowalski@example.com"
                      phone: "+48 123 456 789"
                      termsAccepted: true
                    vehicle:
                      id: "tcrn:vehicle:3fa85f64-5717-4562-b3fc-2c963f66afa6"
                      make: "Toyota"
                      model: "RAV4"
                      year: 2023
                      vehicleType: "suv"
                      pricePerDay: 250.00
                      currency: "PLN"
                      mainImage: "https://cdn.example.com/vehicles/rav4.jpg"
                    branch:
                      id: "tcrn:branch:22222222-2222-2222-2222-222222222222"
                      name: "Warsaw Downtown"
                      city: "Warsaw"
                    company:
                      id: "tcrn:company:11111111-1111-1111-1111-111111111111"
                      name: "Rent-A-Car Poland"
                    totalPrice: 1750.00
                    currency: "PLN"
                    createdAt: "2024-12-15T10:00:00Z"
                pagination:
                  currentPage: 0
                  pageSize: 20
                  totalElements: 5
                  totalPages: 1

        '401':
          description: Not authenticated - missing or invalid token
          content:
            application/json:
              schema:
                $ref: '../shared/schemas/common.yaml#/ErrorResponse'
              example:
                error: "Unauthorized"
                message: "Authentication required"
                timestamp: "2024-11-15T12:00:00Z"

        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: '../shared/schemas/common.yaml#/ErrorResponse'

  /reservations:
    post:
      tags:
        - Reservations
      summary: Create a new reservation
      description: |
        Create a reservation for a vehicle. The reservation will be in 'pending' status
        until the company confirms or rejects it.

        **Important:**
        - Reservations auto-cancel if not confirmed within 24 hours
        - A confirmation code is returned for accessing the reservation without authentication
        - Customer receives email confirmation with reservation details
      operationId: createReservation
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '../shared/schemas/reservation.yaml#/CreateReservationRequest'
            example:
              vehicleId: "tcrn:vehicle:3fa85f64-5717-4562-b3fc-2c963f66afa6"
              pickupDate: "2024-12-20T10:00:00Z"
              returnDate: "2024-12-27T10:00:00Z"
              driver:
                firstName: "Jan"
                lastName: "Kowalski"
                email: "jan.kowalski@example.com"
                phone: "+48 123 456 789"
                termsAccepted: true
              notes: "Please have the car ready with a child seat"

      responses:
        '201':
          description: Reservation created successfully
          content:
            application/json:
              schema:
                $ref: '../shared/schemas/reservation.yaml#/CreateReservationResponse'
              example:
                reservation:
                  id: "tcrn:reservation:aabbccdd-1122-3344-5566-778899aabbcc"
                  status: "pending"
                  pickupDate: "2024-12-20T10:00:00Z"
                  returnDate: "2024-12-27T10:00:00Z"
                  driver:
                    firstName: "Jan"
                    lastName: "Kowalski"
                    email: "jan.kowalski@example.com"
                    phone: "+48 123 456 789"
                    termsAccepted: true
                  vehicle:
                    id: "tcrn:vehicle:3fa85f64-5717-4562-b3fc-2c963f66afa6"
                    make: "Toyota"
                    model: "RAV4"
                    year: 2023
                    vehicleType: "suv"
                    pricePerDay: 250.00
                    currency: "PLN"
                    mainImage: "https://cdn.example.com/vehicles/rav4.jpg"
                  branch:
                    id: "tcrn:branch:22222222-2222-2222-2222-222222222222"
                    name: "Warsaw Downtown"
                    city: "Warsaw"
                  company:
                    id: "tcrn:company:11111111-1111-1111-1111-111111111111"
                    name: "Rent-A-Car Poland"
                  totalPrice: 1750.00
                  currency: "PLN"
                  notes: "Please have the car ready with a child seat"
                  expiresAt: "2024-12-16T10:00:00Z"
                  createdAt: "2024-12-15T10:00:00Z"
                confirmationCode: "ABC12345"
                message: "Reservation created successfully. Awaiting company confirmation."

        '400':
          description: Bad request - validation error
          content:
            application/json:
              schema:
                $ref: '../shared/schemas/common.yaml#/ErrorResponse'
              examples:
                invalidDateRange:
                  summary: Invalid date range
                  value:
                    error: "Bad Request"
                    message: "returnDate must be after pickupDate"
                    timestamp: "2024-11-15T12:00:00Z"
                termsNotAccepted:
                  summary: Terms not accepted
                  value:
                    error: "Bad Request"
                    message: "Driver must accept terms and conditions"
                    timestamp: "2024-11-15T12:00:00Z"
                pastPickupDate:
                  summary: Pickup date in the past
                  value:
                    error: "Bad Request"
                    message: "Pickup date cannot be in the past"
                    timestamp: "2024-11-15T12:00:00Z"

        '404':
          description: Vehicle not found
          content:
            application/json:
              schema:
                $ref: '../shared/schemas/common.yaml#/ErrorResponse'
              example:
                error: "Not Found"
                message: "Vehicle not found"
                timestamp: "2024-11-15T12:00:00Z"

        '409':
          description: Conflict - vehicle not available for the requested dates
          content:
            application/json:
              schema:
                $ref: '../shared/schemas/common.yaml#/ErrorResponse'
              example:
                error: "Conflict"
                message: "Vehicle is not available for the requested dates"
                timestamp: "2024-11-15T12:00:00Z"

        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: '../shared/schemas/common.yaml#/ErrorResponse'

  /reservations/{reservationId}:
    get:
      tags:
        - Reservations
      summary: Get reservation details
      description: |
        Retrieve details of a specific reservation.

        **Access methods:**
        - Authenticated user: Access their own reservations via Authorization header
        - Anyone with confirmation code: Use confirmationCode query parameter
      operationId: getReservation
      parameters:
        - name: reservationId
          in: path
          required: true
          description: Unique identifier of the reservation
          schema:
            $ref: '../shared/schemas/common.yaml#/ReservationId'
        - name: confirmationCode
          in: query
          required: false
          description: 8-character confirmation code (alternative to authentication)
          schema:
            type: string
            pattern: '^[A-Z0-9]{8}$'
          example: "ABC12345"

      responses:
        '200':
          description: Reservation details retrieved successfully
          content:
            application/json:
              schema:
                $ref: '../shared/schemas/reservation.yaml#/ReservationDetails'
              example:
                id: "tcrn:reservation:aabbccdd-1122-3344-5566-778899aabbcc"
                status: "confirmed"
                pickupDate: "2024-12-20T10:00:00Z"
                returnDate: "2024-12-27T10:00:00Z"
                driver:
                  firstName: "Jan"
                  lastName: "Kowalski"
                  email: "jan.kowalski@example.com"
                  phone: "+48 123 456 789"
                  termsAccepted: true
                vehicle:
                  id: "tcrn:vehicle:3fa85f64-5717-4562-b3fc-2c963f66afa6"
                  make: "Toyota"
                  model: "RAV4"
                  year: 2023
                  vehicleType: "suv"
                  transmission: "automatic"
                  fuelType: "hybrid"
                  seats: 5
                  pricePerDay: 250.00
                  currency: "PLN"
                  mainImage: "https://cdn.example.com/vehicles/rav4.jpg"
                branch:
                  id: "tcrn:branch:22222222-2222-2222-2222-222222222222"
                  name: "Warsaw Downtown"
                  city: "Warsaw"
                  address: "ul. Marszałkowska 1"
                company:
                  id: "tcrn:company:11111111-1111-1111-1111-111111111111"
                  name: "Rent-A-Car Poland"
                totalPrice: 1750.00
                currency: "PLN"
                notes: "Please have the car ready with a child seat"
                createdAt: "2024-12-15T10:00:00Z"
                updatedAt: "2024-12-15T14:30:00Z"

        '401':
          description: Unauthorized - no valid authentication or confirmation code
          content:
            application/json:
              schema:
                $ref: '../shared/schemas/common.yaml#/ErrorResponse'

        '403':
          description: Forbidden - not authorized to view this reservation
          content:
            application/json:
              schema:
                $ref: '../shared/schemas/common.yaml#/ErrorResponse'
              example:
                error: "Forbidden"
                message: "You are not authorized to view this reservation"
                timestamp: "2024-11-15T12:00:00Z"

        '404':
          description: Reservation not found
          content:
            application/json:
              schema:
                $ref: '../shared/schemas/common.yaml#/ErrorResponse'
              example:
                error: "Not Found"
                message: "Reservation not found"
                timestamp: "2024-11-15T12:00:00Z"

        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: '../shared/schemas/common.yaml#/ErrorResponse'

    patch:
      tags:
        - Reservations
      summary: Request reservation modification
      description: |
        Request changes to an existing reservation. Modifications require company approval.

        **Modifiable fields:**
        - pickupDate: New pickup date and time
        - returnDate: New return date and time
        - notes: Updated notes or special requests

        **Note:** The reservation status will change to 'modification_pending' until the
        company approves or rejects the modification request.

        **Access methods:**
        - Authenticated user: Access their own reservations via Authorization header
        - Anyone with confirmation code: Use confirmationCode query parameter
      operationId: modifyReservation
      parameters:
        - name: reservationId
          in: path
          required: true
          description: Unique identifier of the reservation
          schema:
            $ref: '../shared/schemas/common.yaml#/ReservationId'
        - name: confirmationCode
          in: query
          required: false
          description: 8-character confirmation code (alternative to authentication)
          schema:
            type: string
            pattern: '^[A-Z0-9]{8}$'
          example: "ABC12345"

      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '../shared/schemas/reservation.yaml#/ModifyReservationRequest'
            example:
              pickupDate: "2024-12-21T10:00:00Z"
              returnDate: "2024-12-28T10:00:00Z"

      responses:
        '200':
          description: Modification request submitted successfully
          content:
            application/json:
              schema:
                $ref: '../shared/schemas/reservation.yaml#/ReservationDetails'

        '400':
          description: Bad request - validation error or no changes provided
          content:
            application/json:
              schema:
                $ref: '../shared/schemas/common.yaml#/ErrorResponse'
              example:
                error: "Bad Request"
                message: "At least one field must be provided for modification"
                timestamp: "2024-11-15T12:00:00Z"

        '409':
          description: Conflict - cannot modify reservation in current status
          content:
            application/json:
              schema:
                $ref: '../shared/schemas/common.yaml#/ErrorResponse'
              example:
                status: 409
                error: "Conflict"
                errorCode: "CONFLICT"
                message: "Reservation cannot be modified in status: completed"
                timestamp: "2024-11-15T12:00:00Z"

        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '../shared/schemas/common.yaml#/ErrorResponse'

        '403':
          description: Forbidden
          content:
            application/json:
              schema:
                $ref: '../shared/schemas/common.yaml#/ErrorResponse'

        '404':
          description: Reservation not found
          content:
            application/json:
              schema:
                $ref: '../shared/schemas/common.yaml#/ErrorResponse'

        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: '../shared/schemas/common.yaml#/ErrorResponse'

    delete:
      tags:
        - Reservations
      summary: Cancel reservation
      description: |
        Cancel a reservation. Customers can cancel their reservations at any time
        before pickup (subject to cancellation policy).

        **Cancellation rules:**
        - Pending reservations can be cancelled freely
        - Confirmed reservations may be subject to cancellation fees (handled externally)
        - Completed or no_show reservations cannot be cancelled

        **Access methods:**
        - Authenticated user: Access their own reservations via Authorization header
        - Anyone with confirmation code: Use confirmationCode query parameter
      operationId: cancelReservation
      parameters:
        - name: reservationId
          in: path
          required: true
          description: Unique identifier of the reservation
          schema:
            $ref: '../shared/schemas/common.yaml#/ReservationId'
        - name: confirmationCode
          in: query
          required: false
          description: 8-character confirmation code (alternative to authentication)
          schema:
            type: string
            pattern: '^[A-Z0-9]{8}$'
          example: "ABC12345"

      responses:
        '200':
          description: Reservation cancelled successfully
          content:
            application/json:
              schema:
                $ref: '../shared/schemas/reservation.yaml#/CancelReservationResponse'
              example:
                message: "Reservation cancelled successfully"
                reservation:
                  id: "tcrn:reservation:aabbccdd-1122-3344-5566-778899aabbcc"
                  status: "cancelled"
                  pickupDate: "2024-12-20T10:00:00Z"
                  returnDate: "2024-12-27T10:00:00Z"

        '409':
          description: Conflict - cannot cancel reservation in current status
          content:
            application/json:
              schema:
                $ref: '../shared/schemas/common.yaml#/ErrorResponse'
              example:
                status: 409
                error: "Conflict"
                errorCode: "CONFLICT"
                message: "Reservation cannot be cancelled in status: completed"
                timestamp: "2024-11-15T12:00:00Z"

        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '../shared/schemas/common.yaml#/ErrorResponse'

        '403':
          description: Forbidden
          content:
            application/json:
              schema:
                $ref: '../shared/schemas/common.yaml#/ErrorResponse'

        '404':
          description: Reservation not found
          content:
            application/json:
              schema:
                $ref: '../shared/schemas/common.yaml#/ErrorResponse'

        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: '../shared/schemas/common.yaml#/ErrorResponse'

  /reservations/{reservationId}/verify-phone:
    post:
      tags:
        - Reservations
      summary: Verify phone number with SMS code
      description: |
        Submit the 6-digit SMS verification code to verify the customer's phone number.

        After creating a reservation, an SMS with a verification code is sent to the
        customer's phone. This endpoint verifies that code and transitions the reservation
        from 'phone_verification_pending' to 'pending' status.

        **Important:**
        - The verification code expires after 10 minutes
        - Maximum 3 attempts allowed before the code is invalidated
        - A new code can be requested via the resend endpoint
      operationId: verifyPhone
      parameters:
        - name: reservationId
          in: path
          required: true
          description: Unique identifier of the reservation
          schema:
            $ref: '../shared/schemas/common.yaml#/ReservationId'
        - name: confirmationCode
          in: query
          required: true
          description: 8-character reservation confirmation code
          schema:
            type: string
            pattern: '^[A-Z0-9]{8}$'
          example: "ABC12345"

      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '../shared/schemas/reservation.yaml#/VerifyPhoneRequest'
            example:
              code: "123456"

      responses:
        '200':
          description: Phone number verified successfully
          content:
            application/json:
              schema:
                $ref: '../shared/schemas/reservation.yaml#/VerifyPhoneResponse'
              example:
                message: "Phone number verified successfully. Reservation is now pending company confirmation."
                reservation:
                  id: "tcrn:reservation:aabbccdd-1122-3344-5566-778899aabbcc"
                  status: "pending"
                  pickupDate: "2024-12-20T10:00:00Z"
                  returnDate: "2024-12-27T10:00:00Z"

        '400':
          description: Bad request - invalid or expired code
          content:
            application/json:
              schema:
                $ref: '../shared/schemas/common.yaml#/ErrorResponse'
              examples:
                invalidCode:
                  summary: Invalid verification code
                  value:
                    error: "Bad Request"
                    message: "Invalid verification code"
                    timestamp: "2024-11-15T12:00:00Z"
                expiredCode:
                  summary: Verification code expired
                  value:
                    error: "Bad Request"
                    message: "Verification code has expired. Please request a new code."
                    timestamp: "2024-11-15T12:00:00Z"
                tooManyAttempts:
                  summary: Too many failed attempts
                  value:
                    error: "Bad Request"
                    message: "Too many failed attempts. Please request a new code."
                    timestamp: "2024-11-15T12:00:00Z"
                wrongStatus:
                  summary: Reservation not in verification pending status
                  value:
                    error: "Bad Request"
                    message: "Reservation is not pending phone verification"
                    timestamp: "2024-11-15T12:00:00Z"

        '403':
          description: Forbidden - invalid confirmation code
          content:
            application/json:
              schema:
                $ref: '../shared/schemas/common.yaml#/ErrorResponse'
              example:
                error: "Forbidden"
                message: "Invalid confirmation code"
                timestamp: "2024-11-15T12:00:00Z"

        '404':
          description: Reservation not found
          content:
            application/json:
              schema:
                $ref: '../shared/schemas/common.yaml#/ErrorResponse'
              example:
                error: "Not Found"
                message: "Reservation not found"
                timestamp: "2024-11-15T12:00:00Z"

        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: '../shared/schemas/common.yaml#/ErrorResponse'

  /reservations/{reservationId}/resend-verification:
    post:
      tags:
        - Reservations
      summary: Resend phone verification SMS
      description: |
        Request a new SMS verification code to be sent to the customer's phone.

        **Rate limiting:**
        - Maximum 3 resend requests per reservation
        - Minimum 60 seconds between resend requests

        **Note:** The previous verification code will be invalidated.
      operationId: resendVerificationCode
      parameters:
        - name: reservationId
          in: path
          required: true
          description: Unique identifier of the reservation
          schema:
            $ref: '../shared/schemas/common.yaml#/ReservationId'
        - name: confirmationCode
          in: query
          required: true
          description: 8-character reservation confirmation code
          schema:
            type: string
            pattern: '^[A-Z0-9]{8}$'
          example: "ABC12345"

      responses:
        '200':
          description: New verification code sent successfully
          content:
            application/json:
              schema:
                $ref: '../shared/schemas/reservation.yaml#/ResendVerificationCodeResponse'
              example:
                message: "Verification code sent successfully"
                expiresAt: "2024-12-15T10:15:00Z"

        '400':
          description: Bad request - cannot resend code
          content:
            application/json:
              schema:
                $ref: '../shared/schemas/common.yaml#/ErrorResponse'
              examples:
                wrongStatus:
                  summary: Reservation not in verification pending status
                  value:
                    error: "Bad Request"
                    message: "Reservation is not pending phone verification"
                    timestamp: "2024-11-15T12:00:00Z"
                tooManyResends:
                  summary: Too many resend attempts
                  value:
                    error: "Bad Request"
                    message: "Maximum resend attempts exceeded"
                    timestamp: "2024-11-15T12:00:00Z"

        '403':
          description: Forbidden - invalid confirmation code
          content:
            application/json:
              schema:
                $ref: '../shared/schemas/common.yaml#/ErrorResponse'

        '404':
          description: Reservation not found
          content:
            application/json:
              schema:
                $ref: '../shared/schemas/common.yaml#/ErrorResponse'

        '429':
          description: Too many requests - rate limited
          content:
            application/json:
              schema:
                $ref: '../shared/schemas/common.yaml#/ErrorResponse'
              example:
                error: "Too Many Requests"
                message: "Please wait 60 seconds before requesting a new code"
                timestamp: "2024-11-15T12:00:00Z"

        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: '../shared/schemas/common.yaml#/ErrorResponse'

  /verification/phone/send:
    post:
      tags:
        - Phone Verification
      summary: Send OTP to phone number
      description: |
        Send a one-time password (OTP) via SMS to verify phone number ownership.

        **Rate limiting:**
        - Maximum 3 requests per phone number per hour
        - Minimum 60 seconds between requests for same phone number
      operationId: sendPhoneVerificationOtp
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - phoneNumber
                - countryCode
              properties:
                phoneNumber:
                  type: string
                  description: Phone number to verify (with country code)
                  pattern: '^\+?[1-9]\d{1,14}$'
                  example: "+48123456789"
                countryCode:
                  type: string
                  description: ISO 3166-1 alpha-2 country code
                  pattern: '^[A-Z]{2}$'
                  example: "PL"
      responses:
        '200':
          description: OTP sent successfully
          content:
            application/json:
              schema:
                type: object
                required:
                  - success
                  - message
                  - sessionId
                properties:
                  success:
                    type: boolean
                    example: true
                  message:
                    type: string
                    example: "OTP sent to +48***789"
                  sessionId:
                    type: string
                    format: uuid
                    description: Session ID for verification
                    example: "550e8400-e29b-41d4-a716-446655440000"
                  expiresAt:
                    type: string
                    format: date-time
                    description: When the OTP expires
                    example: "2024-12-15T10:15:00Z"
        '400':
          description: Bad request - invalid phone number
          content:
            application/json:
              schema:
                $ref: '../shared/schemas/common.yaml#/ErrorResponse'
        '401':
          description: Not authenticated
          content:
            application/json:
              schema:
                $ref: '../shared/schemas/common.yaml#/ErrorResponse'
        '429':
          description: Too many requests - rate limited
          content:
            application/json:
              schema:
                $ref: '../shared/schemas/common.yaml#/ErrorResponse'
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: '../shared/schemas/common.yaml#/ErrorResponse'

  /verification/phone/verify:
    post:
      tags:
        - Phone Verification
      summary: Verify OTP code
      description: |
        Verify the OTP code sent to the phone number.

        **Rate limiting:**
        - Maximum 5 verification attempts per session
        - Session expires after 15 minutes
      operationId: verifyPhoneOtp
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - sessionId
                - code
              properties:
                sessionId:
                  type: string
                  format: uuid
                  description: Session ID from send request
                  example: "550e8400-e29b-41d4-a716-446655440000"
                code:
                  type: string
                  description: 6-digit OTP code
                  pattern: '^\d{6}$'
                  example: "123456"
      responses:
        '200':
          description: Phone number verified successfully
          content:
            application/json:
              schema:
                type: object
                required:
                  - verified
                  - phoneNumber
                properties:
                  verified:
                    type: boolean
                    example: true
                  phoneNumber:
                    type: string
                    description: The verified phone number
                    example: "+48123456789"
                  verifiedAt:
                    type: string
                    format: date-time
                    example: "2024-12-15T10:05:00Z"
        '400':
          description: Bad request - invalid or expired code
          content:
            application/json:
              schema:
                $ref: '../shared/schemas/common.yaml#/ErrorResponse'
        '401':
          description: Not authenticated
          content:
            application/json:
              schema:
                $ref: '../shared/schemas/common.yaml#/ErrorResponse'
        '403':
          description: Verification failed - incorrect code
          content:
            application/json:
              schema:
                $ref: '../shared/schemas/common.yaml#/ErrorResponse'
        '429':
          description: Too many attempts
          content:
            application/json:
              schema:
                $ref: '../shared/schemas/common.yaml#/ErrorResponse'
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: '../shared/schemas/common.yaml#/ErrorResponse'

  /verification/phone/resend:
    post:
      tags:
        - Phone Verification
      summary: Resend OTP code
      description: |
        Resend the OTP code to the same phone number.

        **Rate limiting:**
        - Maximum 3 resend requests per session
        - Minimum 60 seconds between resend requests
      operationId: resendPhoneVerificationOtp
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - sessionId
              properties:
                sessionId:
                  type: string
                  format: uuid
                  description: Session ID from original send request
                  example: "550e8400-e29b-41d4-a716-446655440000"
      responses:
        '200':
          description: OTP resent successfully
          content:
            application/json:
              schema:
                type: object
                required:
                  - success
                  - message
                properties:
                  success:
                    type: boolean
                    example: true
                  message:
                    type: string
                    example: "OTP resent to +48***789"
                  expiresAt:
                    type: string
                    format: date-time
                    description: When the new OTP expires
                    example: "2024-12-15T10:20:00Z"
        '400':
          description: Bad request - session not found or expired
          content:
            application/json:
              schema:
                $ref: '../shared/schemas/common.yaml#/ErrorResponse'
        '401':
          description: Not authenticated
          content:
            application/json:
              schema:
                $ref: '../shared/schemas/common.yaml#/ErrorResponse'
        '429':
          description: Too many requests - rate limited
          content:
            application/json:
              schema:
                $ref: '../shared/schemas/common.yaml#/ErrorResponse'
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: '../shared/schemas/common.yaml#/ErrorResponse'

  # ==================== PROFILE MANAGEMENT ====================
  /profile:
    post:
      tags:
        - Profile
      summary: Create customer profile
      description: |
        Create a new customer profile with personal information.

        **Authentication required**: This endpoint requires a valid JWT bearer token.

        **Required fields**:
        - firstName: Customer's first name
        - lastName: Customer's last name
        - email: Email address (must match authenticated user)
        - phone: Contact phone number

        **Optional fields**:
        - dateOfBirth: Date of birth (ISO 8601 format)
        - address: Primary address
        - driverLicense: Driver's license information
      operationId: createProfile
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateProfileRequest'
      responses:
        '201':
          description: Profile created successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ProfileResponse'
        '400':
          description: Bad request - validation error
          content:
            application/json:
              schema:
                $ref: '../shared/schemas/common.yaml#/ErrorResponse'
        '401':
          description: Not authenticated
          content:
            application/json:
              schema:
                $ref: '../shared/schemas/common.yaml#/ErrorResponse'
        '409':
          description: Conflict - profile already exists for this user
          content:
            application/json:
              schema:
                $ref: '../shared/schemas/common.yaml#/ErrorResponse'
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: '../shared/schemas/common.yaml#/ErrorResponse'

  /profile/{id}:
    get:
      tags:
        - Profile
      summary: Get profile by ID
      description: |
        Retrieve customer profile details by profile ID.

        **Authentication required**: This endpoint requires a valid JWT bearer token.
        Users can only access their own profile.
      operationId: getProfileById
      security:
        - bearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          description: Profile ID
          schema:
            type: string
            example: "tcrn:profile:507f1f77-bcf8-6cd7-9943-9011aabbccdd"
      responses:
        '200':
          description: Profile retrieved successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ProfileResponse'
        '401':
          description: Not authenticated
          content:
            application/json:
              schema:
                $ref: '../shared/schemas/common.yaml#/ErrorResponse'
        '403':
          description: Forbidden - not authorized to view this profile
          content:
            application/json:
              schema:
                $ref: '../shared/schemas/common.yaml#/ErrorResponse'
        '404':
          description: Profile not found
          content:
            application/json:
              schema:
                $ref: '../shared/schemas/common.yaml#/ErrorResponse'
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: '../shared/schemas/common.yaml#/ErrorResponse'

    put:
      tags:
        - Profile
      summary: Update profile
      description: |
        Update customer profile information.

        **Authentication required**: This endpoint requires a valid JWT bearer token.
        Users can only update their own profile.

        **Note**: Changing email or phone will require re-verification.
      operationId: updateProfile
      security:
        - bearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          description: Profile ID
          schema:
            type: string
            example: "tcrn:profile:507f1f77-bcf8-6cd7-9943-9011aabbccdd"
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UpdateProfileRequest'
      responses:
        '200':
          description: Profile updated successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ProfileResponse'
        '400':
          description: Bad request - validation error
          content:
            application/json:
              schema:
                $ref: '../shared/schemas/common.yaml#/ErrorResponse'
        '401':
          description: Not authenticated
          content:
            application/json:
              schema:
                $ref: '../shared/schemas/common.yaml#/ErrorResponse'
        '403':
          description: Forbidden - not authorized to update this profile
          content:
            application/json:
              schema:
                $ref: '../shared/schemas/common.yaml#/ErrorResponse'
        '404':
          description: Profile not found
          content:
            application/json:
              schema:
                $ref: '../shared/schemas/common.yaml#/ErrorResponse'
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: '../shared/schemas/common.yaml#/ErrorResponse'

    delete:
      tags:
        - Profile
      summary: Delete profile (soft delete)
      description: |
        Soft delete a customer profile. The profile is marked as deleted but not
        physically removed from the database for compliance and audit purposes.

        **Authentication required**: This endpoint requires a valid JWT bearer token.
        Users can only delete their own profile.
      operationId: deleteProfile
      security:
        - bearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          description: Profile ID
          schema:
            type: string
            example: "tcrn:profile:507f1f77-bcf8-6cd7-9943-9011aabbccdd"
      responses:
        '200':
          description: Profile deleted successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/DeleteProfileResponse'
        '401':
          description: Not authenticated
          content:
            application/json:
              schema:
                $ref: '../shared/schemas/common.yaml#/ErrorResponse'
        '403':
          description: Forbidden - not authorized to delete this profile
          content:
            application/json:
              schema:
                $ref: '../shared/schemas/common.yaml#/ErrorResponse'
        '404':
          description: Profile not found
          content:
            application/json:
              schema:
                $ref: '../shared/schemas/common.yaml#/ErrorResponse'
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: '../shared/schemas/common.yaml#/ErrorResponse'

  /profile/{id}/history:
    get:
      tags:
        - Profile
      summary: Get profile change history
      description: |
        Retrieve the history of all changes made to a customer profile.

        **Authentication required**: This endpoint requires a valid JWT bearer token.
        Users can only view their own profile history.
      operationId: getProfileHistory
      security:
        - bearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          description: Profile ID
          schema:
            type: string
            example: "tcrn:profile:507f1f77-bcf8-6cd7-9943-9011aabbccdd"
        - name: page
          in: query
          description: Page number (zero-indexed)
          required: false
          schema:
            type: integer
            default: 0
            minimum: 0
        - name: size
          in: query
          description: Number of items per page
          required: false
          schema:
            type: integer
            default: 20
            minimum: 1
            maximum: 100
      responses:
        '200':
          description: Profile history retrieved successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ProfileHistoryResponse'
        '401':
          description: Not authenticated
          content:
            application/json:
              schema:
                $ref: '../shared/schemas/common.yaml#/ErrorResponse'
        '403':
          description: Forbidden - not authorized to view this profile history
          content:
            application/json:
              schema:
                $ref: '../shared/schemas/common.yaml#/ErrorResponse'
        '404':
          description: Profile not found
          content:
            application/json:
              schema:
                $ref: '../shared/schemas/common.yaml#/ErrorResponse'
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: '../shared/schemas/common.yaml#/ErrorResponse'

  /profile/{id}/avatar:
    post:
      tags:
        - Profile
      summary: Upload profile avatar
      description: |
        Upload a profile avatar image.

        **Authentication required**: This endpoint requires a valid JWT bearer token.

        **Validation**:
        - Maximum file size: 5MB
        - Allowed formats: JPEG, PNG, WebP
        - Image will be resized to 400x400px
      operationId: uploadAvatar
      security:
        - bearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          description: Profile ID
          schema:
            type: string
            example: "tcrn:profile:507f1f77-bcf8-6cd7-9943-9011aabbccdd"
      requestBody:
        required: true
        content:
          multipart/form-data:
            schema:
              type: object
              required:
                - avatar
              properties:
                avatar:
                  type: string
                  format: binary
                  description: Avatar image file
      responses:
        '200':
          description: Avatar uploaded successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ProfileResponse'
        '400':
          description: Bad request - invalid file format or size
          content:
            application/json:
              schema:
                $ref: '../shared/schemas/common.yaml#/ErrorResponse'
        '401':
          description: Not authenticated
          content:
            application/json:
              schema:
                $ref: '../shared/schemas/common.yaml#/ErrorResponse'
        '403':
          description: Forbidden - not authorized to update this profile
          content:
            application/json:
              schema:
                $ref: '../shared/schemas/common.yaml#/ErrorResponse'
        '404':
          description: Profile not found
          content:
            application/json:
              schema:
                $ref: '../shared/schemas/common.yaml#/ErrorResponse'
        '413':
          description: File too large
          content:
            application/json:
              schema:
                $ref: '../shared/schemas/common.yaml#/ErrorResponse'
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: '../shared/schemas/common.yaml#/ErrorResponse'

  /profile/{id}/driver-license:
    put:
      tags:
        - Profile
      summary: Update driver license information
      description: |
        Update or add driver's license information to the profile.

        **Authentication required**: This endpoint requires a valid JWT bearer token.

        **Validation**:
        - License must not be expired
        - Issue date must be before expiry date
        - Valid license number format required
      operationId: updateDriverLicense
      security:
        - bearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          description: Profile ID
          schema:
            type: string
            example: "tcrn:profile:507f1f77-bcf8-6cd7-9943-9011aabbccdd"
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/DriverLicenseRequest'
      responses:
        '200':
          description: Driver license updated successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/DriverLicenseResponse'
        '400':
          description: Bad request - validation error or expired license
          content:
            application/json:
              schema:
                $ref: '../shared/schemas/common.yaml#/ErrorResponse'
        '401':
          description: Not authenticated
          content:
            application/json:
              schema:
                $ref: '../shared/schemas/common.yaml#/ErrorResponse'
        '403':
          description: Forbidden - not authorized to update this profile
          content:
            application/json:
              schema:
                $ref: '../shared/schemas/common.yaml#/ErrorResponse'
        '404':
          description: Profile not found
          content:
            application/json:
              schema:
                $ref: '../shared/schemas/common.yaml#/ErrorResponse'
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: '../shared/schemas/common.yaml#/ErrorResponse'

  /profile/{id}/addresses:
    post:
      tags:
        - Profile
      summary: Add address to profile
      description: |
        Add a new address (home, work, billing, etc.) to the customer profile.

        **Authentication required**: This endpoint requires a valid JWT bearer token.
      operationId: addAddress
      security:
        - bearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          description: Profile ID
          schema:
            type: string
            example: "tcrn:profile:507f1f77-bcf8-6cd7-9943-9011aabbccdd"
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/AddressRequest'
      responses:
        '201':
          description: Address added successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AddressResponse'
        '400':
          description: Bad request - validation error
          content:
            application/json:
              schema:
                $ref: '../shared/schemas/common.yaml#/ErrorResponse'
        '401':
          description: Not authenticated
          content:
            application/json:
              schema:
                $ref: '../shared/schemas/common.yaml#/ErrorResponse'
        '403':
          description: Forbidden - not authorized to update this profile
          content:
            application/json:
              schema:
                $ref: '../shared/schemas/common.yaml#/ErrorResponse'
        '404':
          description: Profile not found
          content:
            application/json:
              schema:
                $ref: '../shared/schemas/common.yaml#/ErrorResponse'
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: '../shared/schemas/common.yaml#/ErrorResponse'

    get:
      tags:
        - Profile
      summary: Get all addresses for profile
      description: |
        Retrieve all addresses associated with a customer profile.

        **Authentication required**: This endpoint requires a valid JWT bearer token.
      operationId: getAddresses
      security:
        - bearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          description: Profile ID
          schema:
            type: string
            example: "tcrn:profile:507f1f77-bcf8-6cd7-9943-9011aabbccdd"
      responses:
        '200':
          description: Addresses retrieved successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AddressListResponse'
        '401':
          description: Not authenticated
          content:
            application/json:
              schema:
                $ref: '../shared/schemas/common.yaml#/ErrorResponse'
        '403':
          description: Forbidden - not authorized to view this profile
          content:
            application/json:
              schema:
                $ref: '../shared/schemas/common.yaml#/ErrorResponse'
        '404':
          description: Profile not found
          content:
            application/json:
              schema:
                $ref: '../shared/schemas/common.yaml#/ErrorResponse'
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: '../shared/schemas/common.yaml#/ErrorResponse'

  /profile/{id}/addresses/{addressId}:
    put:
      tags:
        - Profile
      summary: Update address
      description: |
        Update an existing address for the customer profile.

        **Authentication required**: This endpoint requires a valid JWT bearer token.
      operationId: updateAddress
      security:
        - bearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          description: Profile ID
          schema:
            type: string
            example: "tcrn:profile:507f1f77-bcf8-6cd7-9943-9011aabbccdd"
        - name: addressId
          in: path
          required: true
          description: Address ID
          schema:
            type: string
            example: "tcrn:address:507f1f77-bcf8-6cd7-9943-9011aabbccdd"
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/AddressRequest'
      responses:
        '200':
          description: Address updated successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AddressResponse'
        '400':
          description: Bad request - validation error
          content:
            application/json:
              schema:
                $ref: '../shared/schemas/common.yaml#/ErrorResponse'
        '401':
          description: Not authenticated
          content:
            application/json:
              schema:
                $ref: '../shared/schemas/common.yaml#/ErrorResponse'
        '403':
          description: Forbidden - not authorized to update this profile
          content:
            application/json:
              schema:
                $ref: '../shared/schemas/common.yaml#/ErrorResponse'
        '404':
          description: Address not found
          content:
            application/json:
              schema:
                $ref: '../shared/schemas/common.yaml#/ErrorResponse'
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: '../shared/schemas/common.yaml#/ErrorResponse'

    delete:
      tags:
        - Profile
      summary: Delete address
      description: |
        Delete an address from the customer profile.

        **Authentication required**: This endpoint requires a valid JWT bearer token.
      operationId: deleteAddress
      security:
        - bearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          description: Profile ID
          schema:
            type: string
            example: "tcrn:profile:507f1f77-bcf8-6cd7-9943-9011aabbccdd"
        - name: addressId
          in: path
          required: true
          description: Address ID
          schema:
            type: string
            example: "tcrn:address:507f1f77-bcf8-6cd7-9943-9011aabbccdd"
      responses:
        '204':
          description: Address deleted successfully
        '401':
          description: Not authenticated
          content:
            application/json:
              schema:
                $ref: '../shared/schemas/common.yaml#/ErrorResponse'
        '403':
          description: Forbidden - not authorized to update this profile
          content:
            application/json:
              schema:
                $ref: '../shared/schemas/common.yaml#/ErrorResponse'
        '404':
          description: Address not found
          content:
            application/json:
              schema:
                $ref: '../shared/schemas/common.yaml#/ErrorResponse'
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: '../shared/schemas/common.yaml#/ErrorResponse'

    patch:
      tags:
        - Profile
      summary: Set default address
      description: |
        Set an address as the default for the customer profile.

        **Authentication required**: This endpoint requires a valid JWT bearer token.
      operationId: setDefaultAddress
      security:
        - bearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          description: Profile ID
          schema:
            type: string
            example: "tcrn:profile:507f1f77-bcf8-6cd7-9943-9011aabbccdd"
        - name: addressId
          in: path
          required: true
          description: Address ID
          schema:
            type: string
            example: "tcrn:address:507f1f77-bcf8-6cd7-9943-9011aabbccdd"
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - isDefault
              properties:
                isDefault:
                  type: boolean
                  description: Set as default address
                  example: true
      responses:
        '200':
          description: Default address set successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AddressResponse'
        '401':
          description: Not authenticated
          content:
            application/json:
              schema:
                $ref: '../shared/schemas/common.yaml#/ErrorResponse'
        '403':
          description: Forbidden - not authorized to update this profile
          content:
            application/json:
              schema:
                $ref: '../shared/schemas/common.yaml#/ErrorResponse'
        '404':
          description: Address not found
          content:
            application/json:
              schema:
                $ref: '../shared/schemas/common.yaml#/ErrorResponse'
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: '../shared/schemas/common.yaml#/ErrorResponse'

  /profile/{id}/verify:
    post:
      tags:
        - Profile
      summary: Verify profile
      description: |
        Initiate profile verification process. This may trigger email/phone verification
        or manual review depending on the verification type requested.

        **Authentication required**: This endpoint requires a valid JWT bearer token.
      operationId: verifyProfile
      security:
        - bearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          description: Profile ID
          schema:
            type: string
            example: "tcrn:profile:507f1f77-bcf8-6cd7-9943-9011aabbccdd"
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/VerifyProfileRequest'
      responses:
        '200':
          description: Verification process initiated
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/VerifyProfileResponse'
        '400':
          description: Bad request - profile not ready for verification
          content:
            application/json:
              schema:
                $ref: '../shared/schemas/common.yaml#/ErrorResponse'
        '401':
          description: Not authenticated
          content:
            application/json:
              schema:
                $ref: '../shared/schemas/common.yaml#/ErrorResponse'
        '403':
          description: Forbidden - not authorized to verify this profile
          content:
            application/json:
              schema:
                $ref: '../shared/schemas/common.yaml#/ErrorResponse'
        '404':
          description: Profile not found
          content:
            application/json:
              schema:
                $ref: '../shared/schemas/common.yaml#/ErrorResponse'
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: '../shared/schemas/common.yaml#/ErrorResponse'

components:
  # Customer-specific response schemas
  schemas:
    CustomerProfile:
      type: object
      required:
        - userId
        - email
        - emailVerified
      properties:
        userId:
          type: string
          description: User ID from authentication provider
          example: "auth0|507f1f77bcf86cd799439011"
        email:
          type: string
          format: email
          description: User email address
          example: "jan.kowalski@example.com"
        emailVerified:
          type: boolean
          description: Whether the email address has been verified
          example: true
        name:
          type: string
          nullable: true
          description: User's full name
          example: "Jan Kowalski"
        pictureUrl:
          type: string
          format: uri
          nullable: true
          description: URL to user's profile picture
          example: "https://example.com/profile/jan-kowalski.jpg"

    ReservationListResponse:
      type: object
      required:
        - reservations
        - pagination
      properties:
        reservations:
          type: array
          items:
            $ref: '../shared/schemas/reservation.yaml#/ReservationDetails'
          description: List of user's reservations
        pagination:
          $ref: '../shared/schemas/common.yaml#/PaginationInfo'
          description: Pagination information

    VehicleSearchResponse:
      type: object
      required:
        - vehicles
        - pagination
      properties:
        vehicles:
          type: array
          items:
            $ref: '#/components/schemas/VehicleSearchResult'
          description: List of vehicles from potentially different branches and companies
        pagination:
          $ref: '../shared/schemas/common.yaml#/PaginationInfo'

    CompanyVehicleListResponse:
      type: object
      required:
        - vehicles
        - company
        - pagination
      properties:
        vehicles:
          type: array
          items:
            $ref: '../shared/schemas/vehicle.yaml#/VehicleWithBranch'
          description: List of vehicles from different branches of the same company
        company:
          $ref: '../shared/schemas/common.yaml#/CompanyInfo'
          description: The company that owns all these vehicles
        pagination:
          $ref: '../shared/schemas/common.yaml#/PaginationInfo'

    VehicleListResponse:
      type: object
      required:
        - vehicles
        - branch
        - company
        - pagination
      properties:
        vehicles:
          type: array
          items:
            $ref: '../shared/schemas/vehicle.yaml#/VehicleBase'
          description: List of vehicles from the same branch
        branch:
          $ref: '../shared/schemas/common.yaml#/BranchInfo'
          description: The branch these vehicles belong to
        company:
          $ref: '../shared/schemas/common.yaml#/CompanyInfo'
          description: The company that owns this branch
        pagination:
          $ref: '../shared/schemas/common.yaml#/PaginationInfo'

    # VehicleSearchResult = VehicleBase + branch + company
    VehicleSearchResult:
      allOf:
        - $ref: '../shared/schemas/vehicle.yaml#/VehicleBase'
        - type: object
          required:
            - branch
            - company
          properties:
            branch:
              $ref: '../shared/schemas/common.yaml#/BranchInfo'
            company:
              $ref: '../shared/schemas/common.yaml#/CompanyInfo'

    # Detailed vehicle information including description
    VehicleDetails:
      allOf:
        - $ref: '../shared/schemas/vehicle.yaml#/VehicleBase'
        - type: object
          required:
            - branch
            - company
          properties:
            description:
              type: string
              nullable: true
              description: Vehicle description and additional information
              example: "Spacious and fuel-efficient SUV, perfect for family trips"
            branch:
              $ref: '../shared/schemas/common.yaml#/BranchInfo'
            company:
              $ref: '../shared/schemas/common.yaml#/CompanyInfo'

    # Detailed company information for customer view
    CompanyDetails:
      type: object
      required:
        - id
        - name
      properties:
        id:
          $ref: '../shared/schemas/common.yaml#/CompanyId'
        name:
          type: string
          description: Company name
          example: "Rent-A-Car Poland"
        description:
          type: string
          nullable: true
          description: Company description and marketing text
          example: "Leading car rental company in Poland with over 20 years of experience"
        logoUrl:
          type: string
          format: uri
          nullable: true
          description: URL to company logo image
          example: "https://cdn.example.com/logos/rent-a-car-poland.png"
        websiteUrl:
          type: string
          format: uri
          nullable: true
          description: Company website URL
          example: "https://www.rentacar.pl"
        nip:
          type: string
          nullable: true
          description: Polish tax identification number (NIP)
          pattern: '^\d{10}$'
          example: "1234567890"
        regon:
          type: string
          nullable: true
          description: Polish business registry number (REGON)
          pattern: '^\d{9}(\d{5})?$'
          example: "123456789"
        phone:
          type: string
          nullable: true
          description: Main contact phone number
          example: "+48 22 123 45 67"
        email:
          type: string
          format: email
          nullable: true
          description: Main contact email address
          example: "contact@rentacar.pl"
        address:
          $ref: '#/components/schemas/Address'
        openingHours:
          type: array
          nullable: true
          description: Opening hours for each day of the week
          items:
            $ref: '#/components/schemas/OpeningHoursEntry'
        rating:
          type: integer
          nullable: true
          minimum: 0
          maximum: 50
          description: Average customer rating in tenths (e.g., 45 = 4.5 stars, range 0-50)
          example: 45
        reviewCount:
          type: integer
          nullable: true
          minimum: 0
          description: Total number of customer reviews
          example: 127

    Address:
      type: object
      properties:
        street:
          type: string
          description: Street name and number
          example: "ul. Marszałkowska 1"
        city:
          type: string
          description: City name
          example: "Warszawa"
        postalCode:
          type: string
          description: Postal code
          example: "00-001"
        country:
          type: string
          description: Country name or ISO code
          example: "Poland"

    OpeningHoursEntry:
      type: object
      required:
        - dayOfWeek
      properties:
        dayOfWeek:
          type: string
          enum: [MONDAY, TUESDAY, WEDNESDAY, THURSDAY, FRIDAY, SATURDAY, SUNDAY]
          description: Day of the week
        openTime:
          type: string
          pattern: '^([01]\d|2[0-3]):([0-5]\d)$'
          nullable: true
          description: Opening time in HH:MM format (null if closed)
          example: "08:00"
        closeTime:
          type: string
          pattern: '^([01]\d|2[0-3]):([0-5]\d)$'
          nullable: true
          description: Closing time in HH:MM format (null if closed)
          example: "18:00"
        closed:
          type: boolean
          default: false
          description: Whether the company is closed on this day

    # ==================== GDPR Schemas ====================
    UserDataExportResponse:
      type: object
      required:
        - exportedAt
        - reservations
        - phoneVerifications
        - auditEvents
      properties:
        exportedAt:
          type: string
          format: date-time
          description: When this export was generated
          example: "2024-12-15T10:00:00Z"
        profile:
          $ref: '#/components/schemas/ExportedUserProfile'
          nullable: true
          description: User profile (null if user has no database record yet)
        reservations:
          type: array
          items:
            $ref: '#/components/schemas/ExportedReservation'
          description: All reservations associated with this user
        phoneVerifications:
          type: array
          items:
            $ref: '#/components/schemas/ExportedPhoneVerification'
          description: Phone verifications linked to user's reservations
        auditEvents:
          type: array
          items:
            $ref: '#/components/schemas/ExportedAuditEvent'
          description: Audit trail of user's actions

    ExportedUserProfile:
      type: object
      required:
        - firebaseUid
        - email
        - userType
        - createdAt
      properties:
        id:
          type: string
          description: Internal user ID (prefixed format)
          example: "tcrn:user:507f1f77-bcf8-6cd7-9943-9011aabbccdd"
        firebaseUid:
          type: string
          description: Firebase user identifier
          example: "firebase_507f1f77bcf86cd799439011"
        email:
          type: string
          format: email
          description: User email address
          example: "jan.kowalski@example.com"
        emailVerified:
          type: boolean
          description: Whether email has been verified
          example: true
        name:
          type: string
          nullable: true
          description: User display name
          example: "Jan Kowalski"
        pictureUrl:
          type: string
          format: uri
          nullable: true
          description: Profile picture URL
          example: "https://example.com/profile/jan-kowalski.jpg"
        userType:
          type: string
          enum: [CUSTOMER, COMPANY]
          description: Type of user
          example: "CUSTOMER"
        createdAt:
          type: string
          format: date-time
          description: When the user was created
          example: "2024-01-15T10:00:00Z"
        lastLoginAt:
          type: string
          format: date-time
          nullable: true
          description: Last login timestamp
          example: "2024-12-15T10:00:00Z"

    ExportedReservation:
      type: object
      required:
        - id
        - status
        - pickupDate
        - returnDate
        - createdAt
      properties:
        id:
          type: string
          description: Reservation ID (prefixed format)
          example: "tcrn:reservation:aabbccdd-1122-3344-5566-778899aabbcc"
        confirmationCode:
          type: string
          description: Unique confirmation code
          example: "ABC12345"
        status:
          type: string
          description: Reservation status
          example: "confirmed"
        pickupDate:
          type: string
          format: date-time
          description: Scheduled pickup date and time
          example: "2024-12-20T10:00:00Z"
        returnDate:
          type: string
          format: date-time
          description: Scheduled return date and time
          example: "2024-12-27T10:00:00Z"
        driver:
          $ref: '../shared/schemas/reservation.yaml#/DriverInfo'
          description: Driver contact information
        vehicleId:
          type: string
          nullable: true
          description: Reserved vehicle ID
          example: "tcrn:vehicle:3fa85f64-5717-4562-b3fc-2c963f66afa6"
        branchId:
          type: string
          nullable: true
          description: Pickup branch ID
          example: "tcrn:branch:22222222-2222-2222-2222-222222222222"
        companyId:
          type: string
          nullable: true
          description: Rental company ID
          example: "tcrn:company:11111111-1111-1111-1111-111111111111"
        totalPrice:
          type: integer
          format: int64
          nullable: true
          description: Total price in smallest currency unit (cents)
          example: 175000
        currency:
          type: string
          nullable: true
          description: Currency code
          example: "PLN"
        notes:
          type: string
          nullable: true
          description: Customer notes
          example: "Please have the car ready with a child seat"
        createdAt:
          type: string
          format: date-time
          description: When the reservation was created
          example: "2024-12-15T10:00:00Z"
        updatedAt:
          type: string
          format: date-time
          nullable: true
          description: When the reservation was last updated
          example: "2024-12-15T14:30:00Z"

    ExportedPhoneVerification:
      type: object
      required:
        - id
        - reservationId
        - phoneNumber
        - createdAt
      properties:
        id:
          type: string
          description: Verification record ID
          example: "tcrn:phone-verification:11223344-5566-7788-99aa-bbccddeeff00"
        reservationId:
          type: string
          description: Associated reservation ID
          example: "tcrn:reservation:aabbccdd-1122-3344-5566-778899aabbcc"
        phoneNumber:
          type: string
          description: Phone number that was verified
          example: "+48 123 456 789"
        verified:
          type: boolean
          description: Whether verification was successful
          example: true
        verifiedAt:
          type: string
          format: date-time
          nullable: true
          description: When the phone was verified
          example: "2024-12-15T10:05:00Z"
        createdAt:
          type: string
          format: date-time
          description: When the verification was created
          example: "2024-12-15T10:00:00Z"

    ExportedAuditEvent:
      type: object
      required:
        - id
        - operation
        - createdAt
      properties:
        id:
          type: string
          description: Audit event ID
          example: "tcrn:audit:11223344-5566-7788-99aa-bbccddeeff00"
        operation:
          type: string
          description: Operation performed (CREATE, READ, UPDATE, DELETE, etc.)
          example: "CREATE"
        resourceType:
          type: string
          nullable: true
          description: Type of resource affected
          example: "RESERVATION"
        resourceId:
          type: string
          nullable: true
          description: ID of the affected resource
          example: "tcrn:reservation:aabbccdd-1122-3344-5566-778899aabbcc"
        httpMethod:
          type: string
          nullable: true
          description: HTTP method used
          example: "POST"
        endpoint:
          type: string
          nullable: true
          description: API endpoint called
          example: "/api/v1/customer/reservations"
        success:
          type: boolean
          nullable: true
          description: Whether the operation succeeded
          example: true
        actorIp:
          type: string
          nullable: true
          description: IP address of the actor
          example: "192.168.1.100"
        userAgent:
          type: string
          nullable: true
          description: User agent string
          example: "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36"
        createdAt:
          type: string
          format: date-time
          description: When the event occurred
          example: "2024-12-15T10:00:00Z"

    AccountDeletionResponse:
      type: object
      required:
        - message
        - deletedAt
        - reservationsAnonymized
        - phoneVerificationsDeleted
        - auditEventsAnonymized
      properties:
        message:
          type: string
          description: Confirmation message
          example: "Your account has been successfully deleted. All personal data has been removed or anonymized."
        deletedAt:
          type: string
          format: date-time
          description: When the deletion was processed
          example: "2024-12-15T10:00:00Z"
        reservationsAnonymized:
          type: integer
          description: Number of reservations that were anonymized
          example: 5
        phoneVerificationsDeleted:
          type: integer
          description: Number of phone verification records that were deleted
          example: 3
        auditEventsAnonymized:
          type: integer
          description: Number of audit events that were anonymized
          example: 12

    # ==================== PROFILE MANAGEMENT SCHEMAS ====================
    CreateProfileRequest:
      type: object
      required:
        - firstName
        - lastName
        - email
      properties:
        firstName:
          type: string
          description: Customer's first name
          minLength: 1
          maxLength: 100
          example: "Jan"
        lastName:
          type: string
          description: Customer's last name
          minLength: 1
          maxLength: 100
          example: "Kowalski"
        email:
          type: string
          format: email
          description: Customer's email address
          example: "jan.kowalski@example.com"
        phone:
          type: string
          description: Customer's phone number (E.164 format)
          pattern: '^\+?[1-9]\d{7,14}$'
          example: "+48123456789"
        dateOfBirth:
          type: string
          format: date
          description: Customer's date of birth (ISO 8601 format)
          nullable: true
          example: "1990-01-15"
        address:
          $ref: '#/components/schemas/AddressRequest'
          nullable: true
        driverLicense:
          $ref: '#/components/schemas/DriverLicenseRequest'
          nullable: true

    UpdateProfileRequest:
      type: object
      properties:
        firstName:
          type: string
          minLength: 1
          maxLength: 100
          example: "Jan"
        lastName:
          type: string
          minLength: 1
          maxLength: 100
          example: "Kowalski"
        email:
          type: string
          format: email
          example: "jan.kowalski@example.com"
        phone:
          type: string
          pattern: '^\+?[1-9]\d{7,14}$'
          example: "+48123456789"
        dateOfBirth:
          type: string
          format: date
          nullable: true
          example: "1990-01-15"

    ProfileResponse:
      type: object
      required:
        - id
        - firstName
        - lastName
        - email
        - phone
        - status
        - isVerified
        - isDeleted
        - createdAt
      properties:
        id:
          type: string
          description: Profile ID (prefixed format)
          example: "tcrn:profile:507f1f77-bcf8-6cd7-9943-9011aabbccdd"
        firstName:
          type: string
          example: "Jan"
        lastName:
          type: string
          example: "Kowalski"
        email:
          type: string
          format: email
          example: "jan.kowalski@example.com"
        phone:
          type: string
          example: "+48123456789"
        status:
          type: string
          enum: [ACTIVE, VERIFIED, PENDING_VERIFICATION, DELETED]
          description: Current status of the profile
          example: "VERIFIED"
        dateOfBirth:
          type: string
          format: date
          nullable: true
          example: "1990-01-15"
        avatarUrl:
          type: string
          format: uri
          nullable: true
          description: URL to profile avatar image
          example: "https://storage.example.com/avatars/507f1f77.jpg"
        emailVerified:
          type: boolean
          description: Whether email has been verified
          example: true
        phoneVerified:
          type: boolean
          description: Whether phone has been verified
          example: true
        isVerified:
          type: boolean
          description: Whether the profile is fully verified
          example: true
        pendingVerification:
          type: boolean
          description: Whether verification is pending
          example: false
        isDeleted:
          type: boolean
          description: Whether the profile has been soft deleted
          example: false
        deletedAt:
          type: string
          format: date-time
          nullable: true
          description: When the profile was deleted
          example: null
        addresses:
          type: array
          items:
            $ref: '#/components/schemas/AddressResponse'
          nullable: true
        driverLicense:
          $ref: '#/components/schemas/DriverLicenseResponse'
          nullable: true
        defaultAddressId:
          type: string
          nullable: true
          description: ID of the default address
          example: "tcrn:address:507f1f77-bcf8-6cd7-9943-9011aabbccdd"
        createdAt:
          type: string
          format: date-time
          example: "2024-01-15T10:00:00Z"
        updatedAt:
          type: string
          format: date-time
          nullable: true
          example: "2024-01-20T14:30:00Z"

    DeleteProfileResponse:
      type: object
      required:
        - message
        - deletedAt
        - status
      properties:
        message:
          type: string
          example: "Profile deleted successfully"
        deletedAt:
          type: string
          format: date-time
          example: "2024-01-30T10:00:00Z"
        status:
          type: string
          enum: [DELETED]
          example: "DELETED"

    ProfileHistoryResponse:
      allOf:
        - type: object
          required:
            - content
          properties:
            content:
              type: array
              items:
                $ref: '#/components/schemas/ProfileHistoryEntry'
              description: List of profile history entries
        - $ref: '../shared/schemas/common.yaml#/PaginationInfo'

    ProfileHistoryEntry:
      type: object
      required:
        - id
        - changeType
        - fieldName
        - changedAt
      properties:
        id:
          type: string
          example: "tcrn:profile-history:507f1f77-bcf8-6cd7-9943-9011aabbccdd"
        changeType:
          type: string
          enum: [CREATE, UPDATE, DELETE]
          example: "UPDATE"
        fieldName:
          type: string
          description: Name of the field that changed
          example: "email"
        oldValue:
          type: string
          nullable: true
          description: Previous value (if applicable)
          example: "old@example.com"
        newValue:
          type: string
          nullable: true
          description: New value
          example: "new@example.com"
        changedAt:
          type: string
          format: date-time
          example: "2024-01-20T14:30:00Z"
        changedBy:
          type: string
          nullable: true
          description: User ID who made the change
          example: "tcrn:user:507f1f77-bcf8-6cd7-9943-9011aabbccdd"

    AddressRequest:
      type: object
      required:
        - street
        - city
        - postalCode
        - country
      properties:
        type:
          type: string
          enum: [HOME, WORK, BILLING, SHIPPING, OTHER]
          description: Type of address
          example: "HOME"
        label:
          type: string
          nullable: true
          description: Custom label for the address
          example: "Home Address"
        street:
          type: string
          minLength: 1
          maxLength: 200
          example: "Marszalkowska 123"
        city:
          type: string
          minLength: 1
          maxLength: 100
          example: "Warsaw"
        postalCode:
          type: string
          pattern: '^\d{2}-\d{3}$|^\d{5}$'
          description: Postal code (Polish format XX-XXX or 5 digits)
          example: "00-001"
        country:
          type: string
          minLength: 1
          maxLength: 100
          example: "Poland"
        isDefault:
          type: boolean
          description: Set as default address
          default: false
          example: false

    AddressResponse:
      type: object
      required:
        - id
        - street
        - city
        - postalCode
        - country
        - isDefault
        - createdAt
      properties:
        id:
          type: string
          example: "tcrn:address:507f1f77-bcf8-6cd7-9943-9011aabbccdd"
        type:
          type: string
          enum: [HOME, WORK, BILLING, SHIPPING, OTHER]
          nullable: true
          example: "HOME"
        label:
          type: string
          nullable: true
          example: "Home Address"
        street:
          type: string
          example: "Marszalkowska 123"
        city:
          type: string
          example: "Warsaw"
        postalCode:
          type: string
          example: "00-001"
        country:
          type: string
          example: "Poland"
        isDefault:
          type: boolean
          example: false
        createdAt:
          type: string
          format: date-time
          example: "2024-01-15T10:00:00Z"
        updatedAt:
          type: string
          format: date-time
          nullable: true
          example: "2024-01-20T14:30:00Z"

    AddressListResponse:
      type: object
      required:
        - addresses
      properties:
        addresses:
          type: array
          items:
            $ref: '#/components/schemas/AddressResponse'

    DriverLicenseRequest:
      type: object
      required:
        - licenseNumber
        - issuingCountry
        - expiryDate
      properties:
        licenseNumber:
          type: string
          minLength: 1
          maxLength: 50
          description: Driver's license number
          example: "DL1234567890"
        issuingCountry:
          type: string
          minLength: 2
          maxLength: 100
          description: Country that issued the license
          example: "Poland"
        issueDate:
          type: string
          format: date
          nullable: true
          description: Date the license was issued
          example: "2019-01-15"
        expiryDate:
          type: string
          format: date
          description: License expiration date
          example: "2029-01-15"
        category:
          type: string
          nullable: true
          description: License category (e.g., B for cars)
          example: "B"

    DriverLicenseResponse:
      type: object
      required:
        - id
        - licenseNumber
        - issuingCountry
        - expiryDate
        - status
      properties:
        id:
          type: string
          example: "tcrn:driver-license:507f1f77-bcf8-6cd7-9943-9011aabbccdd"
        licenseNumber:
          type: string
          example: "DL1234567890"
        issuingCountry:
          type: string
          example: "Poland"
        issueDate:
          type: string
          format: date
          nullable: true
          example: "2019-01-15"
        expiryDate:
          type: string
          format: date
          example: "2029-01-15"
        category:
          type: string
          nullable: true
          example: "B"
        status:
          type: string
          enum: [ACTIVE, EXPIRED, SUSPENDED]
          description: License status
          example: "ACTIVE"
        expired:
          type: boolean
          description: Whether the license is expired
          example: false
        createdAt:
          type: string
          format: date-time
          example: "2024-01-15T10:00:00Z"
        updatedAt:
          type: string
          format: date-time
          nullable: true
          example: "2024-01-20T14:30:00Z"

    AvatarUploadResponse:
      type: object
      required:
        - avatarUrl
        - message
      properties:
        avatarUrl:
          type: string
          format: uri
          description: URL to the uploaded avatar
          example: "https://storage.example.com/avatars/507f1f77.jpg"
        message:
          type: string
          example: "Avatar uploaded successfully"

    VerifyProfileRequest:
      type: object
      required:
        - verificationType
      properties:
        verificationType:
          type: string
          enum: [EMAIL, PHONE, DRIVER_LICENSE, FULL]
          description: Type of verification to perform
          example: "FULL"

    VerifyProfileResponse:
      type: object
      required:
        - message
        - verificationStatus
      properties:
        message:
          type: string
          example: "Verification process initiated"
        verificationStatus:
          type: string
          enum: [PENDING, IN_PROGRESS, VERIFIED, REJECTED]
          example: "PENDING"
        verificationToken:
          type: string
          nullable: true
          description: Token for email/phone verification
          example: "abc123def456"

  securitySchemes:
    bearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT

security:
  - bearerAuth: []
