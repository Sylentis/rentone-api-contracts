# Common schemas shared across all APIs

# Entity ID types - prefixed string format: tcrn:<entity>:<uuid>
VehicleId:
  type: string
  pattern: '^tcrn:vehicle:[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$'
  description: Unique vehicle identifier in prefixed format (tcrn:vehicle:uuid)
  example: "tcrn:vehicle:3fa85f64-5717-4562-b3fc-2c963f66afa6"

BranchId:
  type: string
  pattern: '^tcrn:branch:[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$'
  description: Unique branch identifier in prefixed format (tcrn:branch:uuid)
  example: "tcrn:branch:22222222-2222-2222-2222-222222222222"

CompanyId:
  type: string
  pattern: '^tcrn:company:[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$'
  description: Unique company identifier in prefixed format (tcrn:company:uuid)
  example: "tcrn:company:11111111-1111-1111-1111-111111111111"

ReservationId:
  type: string
  pattern: '^tcrn:reservation:[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$'
  description: Unique reservation identifier in prefixed format (tcrn:reservation:uuid)
  example: "tcrn:reservation:aabbccdd-1122-3344-5566-778899aabbcc"

BranchInfo:
  type: object
  required:
    - id
    - name
    - city
  properties:
    id:
      $ref: '#/BranchId'
    name:
      type: string
      pattern: '^[a-zA-ZÀ-ž\s\-\.'']+$'
      minLength: 1
      maxLength: 100
      description: Branch name
      example: "Warsaw Downtown"
    city:
      type: string
      description: City where the branch is located
      example: "Warsaw"
    address:
      type: string
      nullable: true
      description: Full address of the branch
      example: "ul. Marszałkowska 1, 00-001 Warszawa"

CompanyInfo:
  type: object
  required:
    - id
    - name
  properties:
    id:
      $ref: '#/CompanyId'
    name:
      type: string
      description: Company name
      example: "Rent-A-Car Poland"

PaginationInfo:
  type: object
  required:
    - currentPage
    - pageSize
    - totalElements
    - totalPages
  properties:
    currentPage:
      type: integer
      minimum: 0
      description: Current page number (0-indexed)
      example: 0
    pageSize:
      type: integer
      minimum: 1
      description: Number of items per page
      example: 20
    totalElements:
      type: integer
      minimum: 0
      description: Total number of items across all pages
      example: 45
    totalPages:
      type: integer
      minimum: 0
      description: Total number of pages
      example: 3

ErrorResponse:
  type: object
  description: |
    Standard error response returned by all API endpoints.

    ## Common Error Codes

    | Code | Status | Description |
    |------|--------|-------------|
    | `VALIDATION_ERROR` | 400 | Request validation failed (invalid parameters) |
    | `NOT_FOUND` | 404 | Requested resource does not exist |
    | `CONFLICT` | 409 | Operation cannot be performed in current state |
    | `RATE_LIMIT_EXCEEDED` | 429 | Too many requests, retry after delay |
    | `UNAUTHORIZED` | 401 | Missing or invalid authentication token |
    | `FORBIDDEN` | 403 | Access denied to requested resource |
    | `SERVICE_UNAVAILABLE` | 503 | External service temporarily unavailable |

    ## Business Error Codes

    | Code | Description |
    |------|-------------|
    | `VEHICLE_NOT_AVAILABLE` | Vehicle is not available for the requested dates |
    | `RESERVATION_NOT_MODIFIABLE` | Reservation status does not allow modification |
    | `RESERVATION_NOT_CANCELLABLE` | Reservation status does not allow cancellation |
    | `PHONE_VERIFICATION_REQUIRED` | Phone number must be verified to complete operation |
    | `PHONE_VERIFICATION_EXPIRED` | Verification code has expired, request a new one |
    | `PHONE_VERIFICATION_INVALID` | Invalid verification code provided |
    | `FILE_TOO_LARGE` | Uploaded file exceeds size limit |
    | `INVALID_FILE_TYPE` | Uploaded file type is not allowed |
    | `MAX_IMAGES_EXCEEDED` | Maximum number of images per vehicle reached |
  required:
    - status
    - error
    - errorCode
    - message
    - timestamp
  properties:
    status:
      type: integer
      description: HTTP status code
      example: 400
    error:
      type: string
      description: HTTP error type
      example: "Bad Request"
    errorCode:
      type: string
      description: Machine-readable error code for programmatic handling
      example: "VALIDATION_ERROR"
    message:
      type: string
      description: Human-readable error message with details
      example: "Invalid request parameters: pickup date must be in the future"
    timestamp:
      type: string
      format: date-time
      description: ISO 8601 timestamp when the error occurred
      example: "2024-11-15T12:00:00Z"
    details:
      type: object
      nullable: true
      description: Additional error details (field-specific validation errors, etc.)
      additionalProperties: true
      example:
        pickupDate: "must be in the future"
        returnDate: "must be after pickup date"
