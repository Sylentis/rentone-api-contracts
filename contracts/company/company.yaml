openapi: 3.0.3
info:
  title: RNT-ALPH Company Management API
  description: |
    Company management API for rental companies.
    Allows rental companies to manage their fleet, view reservations, and accept/reject bookings.
  version: 1.0.0
  contact:
    name: RNT-ALPH Team

servers:
  - url: http://localhost:9847/api/v1/company
    description: Local development server
  - url: https://api.rnt-alph.com/v1/company
    description: Production server

tags:
  - name: Fleet Management
    description: Manage company's vehicle fleet
  - name: Reservations
    description: View and manage reservations
  - name: Company Profile
    description: Company profile and settings management
  - name: Company User
    description: User role and permissions within a company

paths:
  # ==================== COMPANY PROFILE ====================
  /profile:
    get:
      tags:
        - Company Profile
      summary: Get company profile
      description: |
        Returns the full profile of the authenticated company.
        Includes contact information, address, logo, and statistics.
      operationId: getCompanyProfile
      responses:
        '200':
          description: Successfully retrieved company profile
          content:
            application/json:
              schema:
                $ref: '../shared/schemas/company-profile.yaml#/CompanyProfile'
              example:
                id: "tcrn:company:11111111-1111-1111-1111-111111111111"
                name: "Rent-A-Car Poland"
                description: "Leading car rental company in Poland with over 20 years of experience"
                email: "contact@rentacar.pl"
                phone: "+48 22 123 45 67"
                websiteUrl: "https://www.rentacar.pl"
                logoUrl: "https://cdn.rnt-alph.com/logos/rentacar-poland.png"
                nip: "1234567890"
                regon: "123456789"
                address:
                  street: "ul. Marszałkowska 100"
                  city: "Warsaw"
                  postalCode: "00-001"
                  country: "Poland"
                rating: 45
                reviewCount: 127
                createdAt: "2020-01-15T10:30:00Z"
                updatedAt: "2024-11-15T14:20:00Z"

        '401':
          description: Unauthorized - invalid or missing authentication
          content:
            application/json:
              schema:
                $ref: '../shared/schemas/common.yaml#/ErrorResponse'

        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: '../shared/schemas/common.yaml#/ErrorResponse'

    patch:
      tags:
        - Company Profile
      summary: Update company profile
      description: |
        Updates the company profile. Only provided fields will be updated.

        **Note:** Logo cannot be updated here - use `POST /profile/logo` instead.

        **Updatable fields:**
        - name, description, email, phone
        - websiteUrl, nip, regon
        - address (street, city, postalCode, country)
      operationId: updateCompanyProfile
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '../shared/schemas/company-profile.yaml#/UpdateCompanyProfileRequest'
            examples:
              updateBasicInfo:
                summary: Update basic info
                value:
                  name: "Rent-A-Car Poland - Premium"
                  description: "Premium car rental services across Poland"
                  phone: "+48 22 999 88 77"
              updateAddress:
                summary: Update address only
                value:
                  address:
                    street: "ul. Nowy Świat 50"
                    city: "Warsaw"
                    postalCode: "00-002"
                    country: "Poland"
              updateAll:
                summary: Full update
                value:
                  name: "Rent-A-Car Poland"
                  description: "Leading car rental company"
                  email: "info@rentacar.pl"
                  phone: "+48 22 123 45 67"
                  websiteUrl: "https://www.rentacar.pl"
                  nip: "1234567890"
                  regon: "123456789"
                  address:
                    street: "ul. Marszałkowska 100"
                    city: "Warsaw"
                    postalCode: "00-001"
                    country: "Poland"

      responses:
        '200':
          description: Profile updated successfully
          content:
            application/json:
              schema:
                $ref: '../shared/schemas/company-profile.yaml#/UpdateCompanyProfileResponse'

        '400':
          description: Bad request - validation error
          content:
            application/json:
              schema:
                $ref: '../shared/schemas/common.yaml#/ErrorResponse'
              examples:
                invalidEmail:
                  summary: Invalid email format
                  value:
                    error: "Bad Request"
                    message: "Invalid email format"
                    timestamp: "2024-11-15T12:00:00Z"
                invalidNip:
                  summary: Invalid NIP format
                  value:
                    error: "Bad Request"
                    message: "NIP must be exactly 10 digits"
                    timestamp: "2024-11-15T12:00:00Z"
                nameTooLong:
                  summary: Name too long
                  value:
                    error: "Bad Request"
                    message: "Name must not exceed 200 characters"
                    timestamp: "2024-11-15T12:00:00Z"

        '401':
          description: Unauthorized - invalid or missing authentication
          content:
            application/json:
              schema:
                $ref: '../shared/schemas/common.yaml#/ErrorResponse'

        '403':
          description: Forbidden - user is not a company owner
          content:
            application/json:
              schema:
                $ref: '../shared/schemas/common.yaml#/ErrorResponse'
              example:
                status: 403
                error: "Forbidden"
                errorCode: "NOT_COMPANY_OWNER"
                message: "Only company owners can edit the company profile"
                timestamp: "2024-11-15T12:00:00Z"

        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: '../shared/schemas/common.yaml#/ErrorResponse'

  /profile/logo:
    post:
      tags:
        - Company Profile
      summary: Upload company logo
      description: |
        Upload or replace the company logo.

        **Supported formats:** JPEG, PNG, GIF, WebP

        **Requirements:**
        - Maximum file size: 5MB
        - Recommended dimensions: 200x200 to 1000x1000 pixels
        - Square images work best

        **Processing:**
        - Images are automatically resized and optimized
        - Previous logo is replaced
      operationId: uploadCompanyLogo
      requestBody:
        required: true
        content:
          multipart/form-data:
            schema:
              type: object
              required:
                - file
              properties:
                file:
                  type: string
                  format: binary
                  description: Logo image file (JPEG, PNG, GIF, WebP)

      responses:
        '200':
          description: Logo uploaded successfully
          content:
            application/json:
              schema:
                $ref: '../shared/schemas/company-profile.yaml#/UploadLogoResponse'
              example:
                logoUrl: "https://cdn.rnt-alph.com/logos/rentacar-poland-abc123.png"
                message: "Logo uploaded successfully"

        '400':
          description: Bad request - invalid file
          content:
            application/json:
              schema:
                $ref: '../shared/schemas/common.yaml#/ErrorResponse'
              examples:
                invalidFormat:
                  summary: Invalid file format
                  value:
                    error: "Bad Request"
                    message: "Unsupported file format. Allowed: jpeg, png, gif, webp"
                    timestamp: "2024-11-15T12:00:00Z"
                noFile:
                  summary: No file provided
                  value:
                    error: "Bad Request"
                    message: "No file provided"
                    timestamp: "2024-11-15T12:00:00Z"

        '401':
          description: Unauthorized - invalid or missing authentication
          content:
            application/json:
              schema:
                $ref: '../shared/schemas/common.yaml#/ErrorResponse'

        '413':
          description: File too large
          content:
            application/json:
              schema:
                $ref: '../shared/schemas/common.yaml#/ErrorResponse'
              example:
                error: "Payload Too Large"
                message: "File size exceeds maximum allowed (5MB)"
                timestamp: "2024-11-15T12:00:00Z"

        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: '../shared/schemas/common.yaml#/ErrorResponse'

    delete:
      tags:
        - Company Profile
      summary: Delete company logo
      description: |
        Removes the company logo. The company will have no logo until a new one is uploaded.
      operationId: deleteCompanyLogo
      responses:
        '200':
          description: Logo deleted successfully
          content:
            application/json:
              schema:
                $ref: '../shared/schemas/company-profile.yaml#/DeleteLogoResponse'
              example:
                message: "Logo deleted successfully"

        '401':
          description: Unauthorized - invalid or missing authentication
          content:
            application/json:
              schema:
                $ref: '../shared/schemas/common.yaml#/ErrorResponse'

        '404':
          description: No logo to delete
          content:
            application/json:
              schema:
                $ref: '../shared/schemas/common.yaml#/ErrorResponse'
              example:
                error: "Not Found"
                message: "Company has no logo to delete"
                timestamp: "2024-11-15T12:00:00Z"

        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: '../shared/schemas/common.yaml#/ErrorResponse'

  # ==================== COMPANY USER ====================
  /user/role:
    get:
      tags:
        - Company User
      summary: Get current user's role in company
      description: |
        Returns the authenticated user's role and permissions within their company.

        **Roles:**
        - **OWNER**: Full access - can edit profile, manage fleet, and manage reservations
        - **MANAGER**: Can manage fleet and reservations, but cannot edit company profile
        - **VIEWER**: Read-only access - can view data but cannot make changes

        Use this endpoint to determine which UI features to enable for the current user.
      operationId: getUserRole
      responses:
        '200':
          description: Successfully retrieved user role and permissions
          content:
            application/json:
              schema:
                $ref: '../shared/schemas/company-user.yaml#/GetUserRoleResponse'
              examples:
                owner:
                  summary: Owner user
                  value:
                    role: "OWNER"
                    canEditProfile: true
                    canManageFleet: true
                    canManageReservations: true
                manager:
                  summary: Manager user
                  value:
                    role: "MANAGER"
                    canEditProfile: false
                    canManageFleet: true
                    canManageReservations: true
                viewer:
                  summary: Viewer user
                  value:
                    role: "VIEWER"
                    canEditProfile: false
                    canManageFleet: false
                    canManageReservations: false

        '401':
          description: Unauthorized - invalid or missing authentication
          content:
            application/json:
              schema:
                $ref: '../shared/schemas/common.yaml#/ErrorResponse'
              example:
                status: 401
                error: "Unauthorized"
                errorCode: "UNAUTHORIZED"
                message: "Invalid or missing authentication token"
                timestamp: "2024-11-15T12:00:00Z"

        '403':
          description: Forbidden - user is not associated with any company
          content:
            application/json:
              schema:
                $ref: '../shared/schemas/common.yaml#/ErrorResponse'
              example:
                status: 403
                error: "Forbidden"
                errorCode: "NOT_COMPANY_MEMBER"
                message: "User is not associated with any company"
                timestamp: "2024-11-15T12:00:00Z"

        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: '../shared/schemas/common.yaml#/ErrorResponse'

  # ==================== FLEET MANAGEMENT ====================
  /vehicles:
    get:
      tags:
        - Fleet Management
      summary: Get all company vehicles
      description: |
        Returns all vehicles belonging to the authenticated company across all branches.
        Companies can filter by branch, vehicle type, and availability status.
      operationId: getCompanyVehicles
      parameters:
        # Fuzzy search
        - $ref: '../shared/parameters/common.yaml#/SearchParam'
        # Branch filtering
        - $ref: '../shared/parameters/common.yaml#/BranchIdQueryParam'
        # Vehicle filters
        - $ref: '../shared/parameters/common.yaml#/VehicleTypeParam'
        - $ref: '../shared/parameters/common.yaml#/TransmissionParam'
        - $ref: '../shared/parameters/common.yaml#/FuelTypeParam'
        - name: available
          in: query
          required: false
          description: Filter by availability status
          schema:
            type: boolean
          example: true
        # Pagination
        - $ref: '../shared/parameters/common.yaml#/PageParam'
        - $ref: '../shared/parameters/common.yaml#/SizeParam'

      responses:
        '200':
          description: Successfully retrieved company vehicles
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/CompanyVehiclesResponse'
              example:
                vehicles:
                  - id: "tcrn:vehicle:3fa85f64-5717-4562-b3fc-2c963f66afa6"
                    make: "Toyota"
                    model: "RAV4"
                    year: 2023
                    vehicleType: "suv"
                    transmission: "automatic"
                    fuelType: "hybrid"
                    seats: 5
                    pricePerDay: 250.00
                    currency: "PLN"
                    mainImage: "https://cdn.example.com/vehicles/rav4.jpg"
                    available: true
                    branch:
                      id: "tcrn:branch:22222222-2222-2222-2222-222222222222"
                      name: "Warsaw Downtown"
                      city: "Warsaw"
                  - id: "tcrn:vehicle:4fa85f64-5717-4562-b3fc-2c963f66afa7"
                    make: "BMW"
                    model: "X5"
                    year: 2024
                    vehicleType: "suv"
                    transmission: "automatic"
                    fuelType: "diesel"
                    seats: 7
                    pricePerDay: 450.00
                    currency: "PLN"
                    mainImage: "https://cdn.example.com/vehicles/bmw-x5.jpg"
                    available: true
                    branch:
                      id: "tcrn:branch:33333333-3333-3333-3333-333333333333"
                      name: "Warsaw Airport"
                      city: "Warsaw"
                pagination:
                  currentPage: 0
                  pageSize: 20
                  totalElements: 45
                  totalPages: 3

        '401':
          description: Unauthorized - invalid or missing authentication
          content:
            application/json:
              schema:
                $ref: '../shared/schemas/common.yaml#/ErrorResponse'
              example:
                error: "Unauthorized"
                message: "Invalid or missing authentication token"
                timestamp: "2024-11-15T12:00:00Z"

        '400':
          description: Bad request - invalid parameters
          content:
            application/json:
              schema:
                $ref: '../shared/schemas/common.yaml#/ErrorResponse'

        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: '../shared/schemas/common.yaml#/ErrorResponse'

    post:
      tags:
        - Fleet Management
      summary: Add a new vehicle
      description: |
        Creates a new vehicle for the authenticated company.
        The vehicle will be assigned to the specified branch.
      operationId: createVehicle
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '../shared/schemas/vehicle.yaml#/CreateVehicleRequest'
            example:
              make: "Toyota"
              model: "RAV4"
              year: 2023
              vehicleType: "suv"
              transmission: "automatic"
              fuelType: "hybrid"
              seats: 5
              pricePerDay: 250.00
              currency: "PLN"
              branchId: "tcrn:branch:22222222-2222-2222-2222-222222222222"
              mainImage: "https://cdn.example.com/vehicles/rav4.jpg"
              available: true

      responses:
        '201':
          description: Vehicle created successfully
          content:
            application/json:
              schema:
                $ref: '../shared/schemas/vehicle.yaml#/CreateVehicleResponse'
              example:
                vehicle:
                  id: "tcrn:vehicle:8fa85f64-5717-4562-b3fc-2c963f66afab"
                  make: "Toyota"
                  model: "RAV4"
                  year: 2023
                  vehicleType: "suv"
                  transmission: "automatic"
                  fuelType: "hybrid"
                  seats: 5
                  pricePerDay: 250.00
                  currency: "PLN"
                  mainImage: "https://cdn.example.com/vehicles/rav4.jpg"
                  available: true
                  branch:
                    id: "tcrn:branch:22222222-2222-2222-2222-222222222222"
                    name: "Warsaw Downtown"
                    city: "Warsaw"
                message: "Vehicle created successfully"

        '400':
          description: Bad request - invalid data
          content:
            application/json:
              schema:
                $ref: '../shared/schemas/common.yaml#/ErrorResponse'
              example:
                error: "Bad Request"
                message: "Validation failed: year must be between 1900 and 2100"
                timestamp: "2024-11-15T12:00:00Z"

        '401':
          description: Unauthorized - invalid or missing authentication
          content:
            application/json:
              schema:
                $ref: '../shared/schemas/common.yaml#/ErrorResponse'

        '403':
          description: Forbidden - branch does not belong to the authenticated company
          content:
            application/json:
              schema:
                $ref: '../shared/schemas/common.yaml#/ErrorResponse'
              example:
                error: "Forbidden"
                message: "Branch does not belong to your company"
                timestamp: "2024-11-15T12:00:00Z"

        '404':
          description: Branch not found
          content:
            application/json:
              schema:
                $ref: '../shared/schemas/common.yaml#/ErrorResponse'
              example:
                error: "Not Found"
                message: "Branch not found"
                timestamp: "2024-11-15T12:00:00Z"

        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: '../shared/schemas/common.yaml#/ErrorResponse'

  /vehicles/{vehicleId}:
    get:
      tags:
        - Fleet Management
      summary: Get vehicle details
      description: |
        Returns detailed information about a specific vehicle.
        Only accessible for vehicles belonging to the authenticated company.
      operationId: getVehicle
      parameters:
        - name: vehicleId
          in: path
          required: true
          description: Unique identifier of the vehicle (prefixed format)
          schema:
            $ref: '../shared/schemas/common.yaml#/VehicleId'

      responses:
        '200':
          description: Vehicle details retrieved successfully
          content:
            application/json:
              schema:
                $ref: '../shared/schemas/vehicle.yaml#/VehicleBase'
              example:
                id: "tcrn:vehicle:3fa85f64-5717-4562-b3fc-2c963f66afa6"
                make: "Toyota"
                model: "RAV4"
                year: 2023
                vehicleType: "suv"
                transmission: "automatic"
                fuelType: "hybrid"
                seats: 5
                pricePerDay: 250.00
                currency: "PLN"
                description: "Spacious SUV perfect for family trips"
                features: ["GPS", "Bluetooth", "Backup Camera"]
                mainImage: "https://cdn.example.com/vehicles/rav4.jpg"
                images:
                  - url: "https://cdn.example.com/vehicles/rav4.jpg"
                    index: 0
                  - url: "https://cdn.example.com/vehicles/rav4-interior.jpg"
                    index: 1
                available: true
                branch:
                  id: "tcrn:branch:22222222-2222-2222-2222-222222222222"
                  name: "Warsaw Downtown"
                  city: "Warsaw"

        '401':
          description: Unauthorized - invalid or missing authentication
          content:
            application/json:
              schema:
                $ref: '../shared/schemas/common.yaml#/ErrorResponse'

        '403':
          description: Forbidden - vehicle does not belong to the authenticated company
          content:
            application/json:
              schema:
                $ref: '../shared/schemas/common.yaml#/ErrorResponse'
              example:
                error: "Forbidden"
                message: "Vehicle does not belong to your company"
                timestamp: "2024-11-15T12:00:00Z"

        '404':
          description: Vehicle not found
          content:
            application/json:
              schema:
                $ref: '../shared/schemas/common.yaml#/ErrorResponse'
              example:
                error: "Not Found"
                message: "Vehicle not found"
                timestamp: "2024-11-15T12:00:00Z"

        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: '../shared/schemas/common.yaml#/ErrorResponse'

    patch:
      tags:
        - Fleet Management
      summary: Update vehicle
      description: |
        Updates an existing vehicle. Only provided fields will be updated.
        The vehicle must belong to the authenticated company.
      operationId: updateVehicle
      parameters:
        - name: vehicleId
          in: path
          required: true
          description: Unique identifier of the vehicle (prefixed format)
          schema:
            $ref: '../shared/schemas/common.yaml#/VehicleId'

      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '../shared/schemas/vehicle.yaml#/UpdateVehicleRequest'
            examples:
              updatePrice:
                summary: Update price only
                value:
                  pricePerDay: 275.00
              updateAvailability:
                summary: Update availability
                value:
                  available: false
              updateMultiple:
                summary: Update multiple fields
                value:
                  pricePerDay: 300.00
                  description: "Recently serviced, excellent condition"
                  features: ["GPS", "Bluetooth", "Backup Camera", "Heated Seats"]
                  available: true

      responses:
        '200':
          description: Vehicle updated successfully
          content:
            application/json:
              schema:
                $ref: '../shared/schemas/vehicle.yaml#/UpdateVehicleResponse'
              example:
                vehicle:
                  id: "tcrn:vehicle:3fa85f64-5717-4562-b3fc-2c963f66afa6"
                  make: "Toyota"
                  model: "RAV4"
                  year: 2023
                  vehicleType: "suv"
                  transmission: "automatic"
                  fuelType: "hybrid"
                  seats: 5
                  pricePerDay: 300.00
                  currency: "PLN"
                  description: "Recently serviced, excellent condition"
                  features: ["GPS", "Bluetooth", "Backup Camera", "Heated Seats"]
                  mainImage: "https://cdn.example.com/vehicles/rav4.jpg"
                  available: true
                  branch:
                    id: "tcrn:branch:22222222-2222-2222-2222-222222222222"
                    name: "Warsaw Downtown"
                    city: "Warsaw"
                message: "Vehicle updated successfully"

        '400':
          description: Bad request - validation error
          content:
            application/json:
              schema:
                $ref: '../shared/schemas/common.yaml#/ErrorResponse'
              example:
                error: "Bad Request"
                message: "Validation failed: pricePerDay must be positive"
                timestamp: "2024-11-15T12:00:00Z"

        '401':
          description: Unauthorized - invalid or missing authentication
          content:
            application/json:
              schema:
                $ref: '../shared/schemas/common.yaml#/ErrorResponse'

        '403':
          description: Forbidden - vehicle does not belong to the authenticated company
          content:
            application/json:
              schema:
                $ref: '../shared/schemas/common.yaml#/ErrorResponse'
              example:
                error: "Forbidden"
                message: "Vehicle does not belong to your company"
                timestamp: "2024-11-15T12:00:00Z"

        '404':
          description: Vehicle not found
          content:
            application/json:
              schema:
                $ref: '../shared/schemas/common.yaml#/ErrorResponse'
              example:
                error: "Not Found"
                message: "Vehicle not found"
                timestamp: "2024-11-15T12:00:00Z"

        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: '../shared/schemas/common.yaml#/ErrorResponse'

    delete:
      tags:
        - Fleet Management
      summary: Delete vehicle
      description: |
        Permanently deletes a vehicle from the company's fleet.
        This action cannot be undone.

        **Note:** Vehicles with active or pending reservations cannot be deleted.
      operationId: deleteVehicle
      parameters:
        - name: vehicleId
          in: path
          required: true
          description: Unique identifier of the vehicle (prefixed format)
          schema:
            $ref: '../shared/schemas/common.yaml#/VehicleId'

      responses:
        '204':
          description: Vehicle deleted successfully

        '401':
          description: Unauthorized - invalid or missing authentication
          content:
            application/json:
              schema:
                $ref: '../shared/schemas/common.yaml#/ErrorResponse'

        '403':
          description: Forbidden - vehicle does not belong to the authenticated company
          content:
            application/json:
              schema:
                $ref: '../shared/schemas/common.yaml#/ErrorResponse'
              example:
                error: "Forbidden"
                message: "Vehicle does not belong to your company"
                timestamp: "2024-11-15T12:00:00Z"

        '404':
          description: Vehicle not found
          content:
            application/json:
              schema:
                $ref: '../shared/schemas/common.yaml#/ErrorResponse'
              example:
                error: "Not Found"
                message: "Vehicle not found"
                timestamp: "2024-11-15T12:00:00Z"

        '409':
          description: Conflict - vehicle has active reservations
          content:
            application/json:
              schema:
                $ref: '../shared/schemas/common.yaml#/ErrorResponse'
              example:
                error: "Conflict"
                message: "Cannot delete vehicle with active or pending reservations"
                timestamp: "2024-11-15T12:00:00Z"

        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: '../shared/schemas/common.yaml#/ErrorResponse'

  /vehicles/import:
    post:
      tags:
        - Fleet Management
      summary: Import vehicles from file
      description: |
        Import multiple vehicles from an Excel (XLSX, XLS) or CSV file.

        **File format requirements:**
        - First row must be a header row with column names
        - Required columns: make, model, year, vehicleType, transmission, fuelType, seats, pricePerDay, branchId
        - Optional columns: currency, mainImage, available

        **Validation behavior:**
        - By default (strict=true), the entire file is validated first
        - If any validation errors are found, no vehicles are imported
        - Set strict=false to import valid rows and skip invalid ones

        **Supported formats:**
        - XLSX (recommended)
        - XLS (legacy Excel)
        - CSV (comma-separated)
      operationId: importVehicles
      parameters:
        - name: strict
          in: query
          required: false
          description: |
            Validation mode:
            - true (default): Validate all rows first, import only if all valid
            - false: Import valid rows, skip invalid ones
          schema:
            type: boolean
            default: true
          example: true

      requestBody:
        required: true
        content:
          multipart/form-data:
            schema:
              type: object
              required:
                - file
              properties:
                file:
                  type: string
                  format: binary
                  description: Excel or CSV file to import

      responses:
        '200':
          description: Import completed (check success field for result)
          content:
            application/json:
              schema:
                $ref: '../shared/schemas/vehicle.yaml#/ImportVehiclesResponse'
              examples:
                success:
                  summary: Successful import
                  value:
                    success: true
                    totalRows: 50
                    validRows: 50
                    invalidRows: 0
                    importedCount: 50
                    message: "Import completed successfully. 50 vehicles imported."
                validationFailed:
                  summary: Validation failed (strict mode)
                  value:
                    success: false
                    totalRows: 50
                    validRows: 48
                    invalidRows: 2
                    errors:
                      - row: 5
                        field: "vehicleType"
                        value: "truck"
                        message: "Invalid vehicle type. Allowed values: sedan, suv, compact, van, luxury"
                      - row: 23
                        field: "year"
                        value: "abc"
                        message: "Year must be a number between 1900 and 2100"
                    message: "Validation failed. Fix 2 errors and try again."
                partialImport:
                  summary: Partial import (non-strict mode)
                  value:
                    success: true
                    totalRows: 50
                    validRows: 48
                    invalidRows: 2
                    importedCount: 48
                    errors:
                      - row: 5
                        field: "vehicleType"
                        value: "truck"
                        message: "Invalid vehicle type. Allowed values: sedan, suv, compact, van, luxury"
                      - row: 23
                        field: "year"
                        value: "abc"
                        message: "Year must be a number between 1900 and 2100"
                    message: "Import completed with warnings. 48 vehicles imported, 2 rows skipped."

        '400':
          description: Bad request - invalid file format or empty file
          content:
            application/json:
              schema:
                $ref: '../shared/schemas/common.yaml#/ErrorResponse'
              examples:
                invalidFormat:
                  summary: Invalid file format
                  value:
                    error: "Bad Request"
                    message: "Unsupported file format. Allowed: xlsx, xls, csv"
                    timestamp: "2024-11-15T12:00:00Z"
                emptyFile:
                  summary: Empty file
                  value:
                    error: "Bad Request"
                    message: "File is empty or contains no data rows"
                    timestamp: "2024-11-15T12:00:00Z"
                missingColumns:
                  summary: Missing required columns
                  value:
                    error: "Bad Request"
                    message: "Missing required columns: vehicleType, fuelType"
                    timestamp: "2024-11-15T12:00:00Z"

        '401':
          description: Unauthorized - invalid or missing authentication
          content:
            application/json:
              schema:
                $ref: '../shared/schemas/common.yaml#/ErrorResponse'

        '413':
          description: File too large
          content:
            application/json:
              schema:
                $ref: '../shared/schemas/common.yaml#/ErrorResponse'
              example:
                error: "Payload Too Large"
                message: "File size exceeds maximum allowed (10MB)"
                timestamp: "2024-11-15T12:00:00Z"

        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: '../shared/schemas/common.yaml#/ErrorResponse'

  /vehicles/export:
    get:
      tags:
        - Fleet Management
      summary: Export vehicles to file
      description: |
        Export company vehicles to an Excel (XLSX) or CSV file.

        **Export includes:**
        - All vehicle data for the authenticated company
        - Optional filtering by branch, vehicle type, etc.

        **File format:**
        - Default: XLSX
        - Optional: CSV
      operationId: exportVehicles
      parameters:
        - name: format
          in: query
          required: false
          description: Export file format
          schema:
            $ref: '../shared/schemas/vehicle.yaml#/ExportFileFormat'
            default: xlsx
          example: xlsx
        # Optional filters (same as GET /vehicles)
        - $ref: '../shared/parameters/common.yaml#/BranchIdQueryParam'
        - $ref: '../shared/parameters/common.yaml#/VehicleTypeParam'
        - $ref: '../shared/parameters/common.yaml#/TransmissionParam'
        - $ref: '../shared/parameters/common.yaml#/FuelTypeParam'
        - name: available
          in: query
          required: false
          description: Filter by availability status
          schema:
            type: boolean
          example: true

      responses:
        '200':
          description: File download
          content:
            application/vnd.openxmlformats-officedocument.spreadsheetml.sheet:
              schema:
                type: string
                format: binary
              example: "(binary file content)"
            text/csv:
              schema:
                type: string
                format: binary
              example: "(CSV file content)"
          headers:
            Content-Disposition:
              schema:
                type: string
              description: Attachment filename
              example: 'attachment; filename="vehicles_export_2024-11-15.xlsx"'

        '401':
          description: Unauthorized - invalid or missing authentication
          content:
            application/json:
              schema:
                $ref: '../shared/schemas/common.yaml#/ErrorResponse'

        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: '../shared/schemas/common.yaml#/ErrorResponse'

  # ==================== VEHICLE IMAGES ====================
  /vehicles/{vehicleId}/images:
    post:
      tags:
        - Fleet Management
      summary: Upload vehicle image
      description: |
        Upload a new image for a vehicle.

        **Supported formats:** JPEG, PNG, GIF, WebP

        **Requirements:**
        - Maximum file size: 5MB
        - Maximum 6 images per vehicle

        **Processing:**
        - Images are automatically stored in object storage
        - New images are added to the end of the image list
      operationId: uploadVehicleImage
      parameters:
        - name: vehicleId
          in: path
          required: true
          description: Unique identifier of the vehicle (prefixed format)
          schema:
            $ref: '../shared/schemas/common.yaml#/VehicleId'
      requestBody:
        required: true
        content:
          multipart/form-data:
            schema:
              type: object
              required:
                - file
              properties:
                file:
                  type: string
                  format: binary
                  description: Image file (JPEG, PNG, GIF, WebP). Max 5MB.

      responses:
        '201':
          description: Image uploaded successfully
          content:
            application/json:
              schema:
                $ref: '../shared/schemas/vehicle-images.yaml#/UploadVehicleImageResponse'
              example:
                imageUrl: "https://cdn.example.com/vehicles/abc123/d4e5f6-0.jpg"
                index: 2
                totalImages: 3

        '400':
          description: Bad request - invalid file format
          content:
            application/json:
              schema:
                $ref: '../shared/schemas/common.yaml#/ErrorResponse'
              examples:
                invalidFormat:
                  summary: Invalid file format
                  value:
                    error: "Bad Request"
                    message: "Unsupported file format. Allowed: jpeg, png, gif, webp"
                    timestamp: "2024-11-15T12:00:00Z"
                noFile:
                  summary: No file provided
                  value:
                    error: "Bad Request"
                    message: "No file provided"
                    timestamp: "2024-11-15T12:00:00Z"

        '401':
          description: Unauthorized - invalid or missing authentication
          content:
            application/json:
              schema:
                $ref: '../shared/schemas/common.yaml#/ErrorResponse'

        '403':
          description: Forbidden - vehicle does not belong to the authenticated company
          content:
            application/json:
              schema:
                $ref: '../shared/schemas/common.yaml#/ErrorResponse'
              example:
                error: "Forbidden"
                message: "Vehicle does not belong to your company"
                timestamp: "2024-11-15T12:00:00Z"

        '404':
          description: Vehicle not found
          content:
            application/json:
              schema:
                $ref: '../shared/schemas/common.yaml#/ErrorResponse'
              example:
                error: "Not Found"
                message: "Vehicle not found"
                timestamp: "2024-11-15T12:00:00Z"

        '409':
          description: Conflict - maximum images limit reached
          content:
            application/json:
              schema:
                $ref: '../shared/schemas/common.yaml#/ErrorResponse'
              example:
                error: "Conflict"
                message: "Maximum number of images (6) reached for this vehicle"
                timestamp: "2024-11-15T12:00:00Z"

        '413':
          description: File too large
          content:
            application/json:
              schema:
                $ref: '../shared/schemas/common.yaml#/ErrorResponse'
              example:
                error: "Payload Too Large"
                message: "File size exceeds maximum allowed (5MB)"
                timestamp: "2024-11-15T12:00:00Z"

        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: '../shared/schemas/common.yaml#/ErrorResponse'

    get:
      tags:
        - Fleet Management
      summary: List vehicle images
      description: |
        Returns all images for a vehicle, ordered by display priority.
        The first image is the main/thumbnail image.
      operationId: listVehicleImages
      parameters:
        - name: vehicleId
          in: path
          required: true
          description: Unique identifier of the vehicle (prefixed format)
          schema:
            $ref: '../shared/schemas/common.yaml#/VehicleId'

      responses:
        '200':
          description: List of vehicle images
          content:
            application/json:
              schema:
                $ref: '../shared/schemas/vehicle-images.yaml#/VehicleImageList'
              example:
                vehicleId: "tcrn:vehicle:3fa85f64-5717-4562-b3fc-2c963f66afa6"
                images:
                  - url: "https://cdn.example.com/vehicles/abc123/img1.jpg"
                    index: 0
                  - url: "https://cdn.example.com/vehicles/abc123/img2.jpg"
                    index: 1
                  - url: "https://cdn.example.com/vehicles/abc123/img3.jpg"
                    index: 2

        '401':
          description: Unauthorized - invalid or missing authentication
          content:
            application/json:
              schema:
                $ref: '../shared/schemas/common.yaml#/ErrorResponse'

        '403':
          description: Forbidden - vehicle does not belong to the authenticated company
          content:
            application/json:
              schema:
                $ref: '../shared/schemas/common.yaml#/ErrorResponse'

        '404':
          description: Vehicle not found
          content:
            application/json:
              schema:
                $ref: '../shared/schemas/common.yaml#/ErrorResponse'

        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: '../shared/schemas/common.yaml#/ErrorResponse'

  /vehicles/{vehicleId}/images/order:
    put:
      tags:
        - Fleet Management
      summary: Reorder vehicle images
      description: |
        Reorder all images for a vehicle.

        **Requirements:**
        - Must provide all existing image URLs in the new desired order
        - The first URL in the list becomes the main/thumbnail image

        **Validation:**
        - All provided URLs must match existing vehicle images
        - Cannot add or remove images through this endpoint
      operationId: reorderVehicleImages
      parameters:
        - name: vehicleId
          in: path
          required: true
          description: Unique identifier of the vehicle (prefixed format)
          schema:
            $ref: '../shared/schemas/common.yaml#/VehicleId'
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '../shared/schemas/vehicle-images.yaml#/ReorderVehicleImagesRequest'
            example:
              imageUrls:
                - "https://cdn.example.com/vehicles/abc123/img2.jpg"
                - "https://cdn.example.com/vehicles/abc123/img1.jpg"
                - "https://cdn.example.com/vehicles/abc123/img3.jpg"

      responses:
        '200':
          description: Images reordered successfully
          content:
            application/json:
              schema:
                $ref: '../shared/schemas/vehicle-images.yaml#/ReorderVehicleImagesResponse'
              example:
                vehicleId: "tcrn:vehicle:3fa85f64-5717-4562-b3fc-2c963f66afa6"
                images:
                  - url: "https://cdn.example.com/vehicles/abc123/img2.jpg"
                    index: 0
                  - url: "https://cdn.example.com/vehicles/abc123/img1.jpg"
                    index: 1
                  - url: "https://cdn.example.com/vehicles/abc123/img3.jpg"
                    index: 2
                message: "Images reordered successfully"

        '400':
          description: Bad request - invalid URL list
          content:
            application/json:
              schema:
                $ref: '../shared/schemas/common.yaml#/ErrorResponse'
              examples:
                missingUrls:
                  summary: Missing URLs
                  value:
                    error: "Bad Request"
                    message: "Provided URLs do not match existing vehicle images"
                    timestamp: "2024-11-15T12:00:00Z"
                extraUrls:
                  summary: Extra URLs
                  value:
                    error: "Bad Request"
                    message: "URL not found in vehicle images: https://..."
                    timestamp: "2024-11-15T12:00:00Z"

        '401':
          description: Unauthorized - invalid or missing authentication
          content:
            application/json:
              schema:
                $ref: '../shared/schemas/common.yaml#/ErrorResponse'

        '403':
          description: Forbidden - vehicle does not belong to the authenticated company
          content:
            application/json:
              schema:
                $ref: '../shared/schemas/common.yaml#/ErrorResponse'

        '404':
          description: Vehicle not found
          content:
            application/json:
              schema:
                $ref: '../shared/schemas/common.yaml#/ErrorResponse'

        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: '../shared/schemas/common.yaml#/ErrorResponse'

  /vehicles/{vehicleId}/images/{imageIndex}:
    delete:
      tags:
        - Fleet Management
      summary: Delete vehicle image
      description: |
        Delete an image from a vehicle by its index.

        **Behavior:**
        - Image is removed from object storage
        - Remaining images are automatically reindexed
        - If main image (index 0) is deleted, the next image becomes main
      operationId: deleteVehicleImage
      parameters:
        - name: vehicleId
          in: path
          required: true
          description: Unique identifier of the vehicle (prefixed format)
          schema:
            $ref: '../shared/schemas/common.yaml#/VehicleId'
        - name: imageIndex
          in: path
          required: true
          description: Index of the image to delete (0-based)
          schema:
            type: integer
            minimum: 0
            maximum: 5
          example: 1

      responses:
        '204':
          description: Image deleted successfully

        '401':
          description: Unauthorized - invalid or missing authentication
          content:
            application/json:
              schema:
                $ref: '../shared/schemas/common.yaml#/ErrorResponse'

        '403':
          description: Forbidden - vehicle does not belong to the authenticated company
          content:
            application/json:
              schema:
                $ref: '../shared/schemas/common.yaml#/ErrorResponse'

        '404':
          description: Vehicle or image not found
          content:
            application/json:
              schema:
                $ref: '../shared/schemas/common.yaml#/ErrorResponse'
              examples:
                vehicleNotFound:
                  summary: Vehicle not found
                  value:
                    error: "Not Found"
                    message: "Vehicle not found"
                    timestamp: "2024-11-15T12:00:00Z"
                imageNotFound:
                  summary: Image not found
                  value:
                    error: "Not Found"
                    message: "Image at index 5 not found"
                    timestamp: "2024-11-15T12:00:00Z"

        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: '../shared/schemas/common.yaml#/ErrorResponse'

  # ==================== RESERVATIONS ====================
  /reservations:
    get:
      tags:
        - Reservations
      summary: Get all reservations for the company
      description: |
        Returns all reservations for vehicles belonging to the authenticated company.
        Filter by status, date range, and other criteria.
      operationId: getCompanyReservations
      parameters:
        # Fuzzy search (driver name, confirmation code, vehicle make/model)
        - $ref: '../shared/parameters/common.yaml#/SearchParam'
        # Status filtering
        - name: status
          in: query
          required: false
          description: Filter by reservation status
          schema:
            $ref: '../shared/schemas/enums.yaml#/ReservationStatus'
          example: "pending"
        # Date range filtering
        - name: pickupDateFrom
          in: query
          required: false
          description: Filter reservations with pickup date on or after this date
          schema:
            type: string
            format: date
          example: "2024-12-01"
        - name: pickupDateTo
          in: query
          required: false
          description: Filter reservations with pickup date on or before this date
          schema:
            type: string
            format: date
          example: "2024-12-31"
        # Sorting
        - name: sort
          in: query
          required: false
          description: Sort order for results
          schema:
            $ref: '../shared/schemas/enums.yaml#/ReservationSortOrder'
            default: created_at_desc
          example: "created_at_desc"
        # Pagination
        - $ref: '../shared/parameters/common.yaml#/PageParam'
        - $ref: '../shared/parameters/common.yaml#/SizeParam'

      responses:
        '200':
          description: Successfully retrieved reservations
          content:
            application/json:
              schema:
                $ref: '../shared/schemas/reservation.yaml#/CompanyReservationListResponse'
              example:
                reservations:
                  - id: "tcrn:reservation:aabbccdd-1122-3344-5566-778899aabbcc"
                    status: "pending"
                    pickupDate: "2024-12-20T10:00:00Z"
                    returnDate: "2024-12-27T10:00:00Z"
                    driver:
                      firstName: "Jan"
                      lastName: "Kowalski"
                      email: "jan.kowalski@example.com"
                      phone: "+48 123 456 789"
                      termsAccepted: true
                    vehicle:
                      id: "tcrn:vehicle:3fa85f64-5717-4562-b3fc-2c963f66afa6"
                      make: "Toyota"
                      model: "RAV4"
                      vehicleType: "suv"
                      mainImage: "https://cdn.example.com/vehicles/rav4.jpg"
                    branch:
                      id: "tcrn:branch:22222222-2222-2222-2222-222222222222"
                      name: "Warsaw Downtown"
                      city: "Warsaw"
                    totalPrice: 1750.00
                    currency: "PLN"
                    expiresAt: "2024-12-16T10:00:00Z"
                    createdAt: "2024-12-15T10:00:00Z"
                  - id: "tcrn:reservation:eeffaabb-5566-7788-9900-112233445566"
                    status: "confirmed"
                    pickupDate: "2024-12-22T09:00:00Z"
                    returnDate: "2024-12-29T18:00:00Z"
                    driver:
                      firstName: "Anna"
                      lastName: "Nowak"
                      email: "anna.nowak@example.com"
                      phone: "+48 987 654 321"
                      termsAccepted: true
                    vehicle:
                      id: "tcrn:vehicle:4fa85f64-5717-4562-b3fc-2c963f66afa7"
                      make: "BMW"
                      model: "X5"
                      vehicleType: "suv"
                      mainImage: "https://cdn.example.com/vehicles/bmw-x5.jpg"
                    branch:
                      id: "tcrn:branch:33333333-3333-3333-3333-333333333333"
                      name: "Warsaw Airport"
                      city: "Warsaw"
                    totalPrice: 3150.00
                    currency: "PLN"
                    createdAt: "2024-12-10T14:30:00Z"
                pagination:
                  currentPage: 0
                  pageSize: 20
                  totalElements: 2
                  totalPages: 1

        '400':
          description: Bad request - invalid parameters
          content:
            application/json:
              schema:
                $ref: '../shared/schemas/common.yaml#/ErrorResponse'

        '401':
          description: Unauthorized - invalid or missing authentication
          content:
            application/json:
              schema:
                $ref: '../shared/schemas/common.yaml#/ErrorResponse'

        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: '../shared/schemas/common.yaml#/ErrorResponse'

    post:
      tags:
        - Reservations
      summary: Create reservation by employee
      description: |
        Create a reservation on behalf of a customer by a company employee (OWNER or MANAGER).
        Employee-created reservations are immediately confirmed (no phone verification required)
        and do not generate platform commission (commission is waived).
      operationId: createEmployeeReservation
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '../shared/schemas/reservation.yaml#/CreateEmployeeReservationRequest'
            example:
              vehicleId: "tcrn:vehicle:3fa85f64-5717-4562-b3fc-2c963f66afa6"
              pickupDate: "2024-12-20T10:00:00Z"
              returnDate: "2024-12-27T10:00:00Z"
              driver:
                firstName: "Jan"
                lastName: "Kowalski"
                email: "jan.kowalski@example.com"
                phone: "+48 123 456 789"
                termsAccepted: true
              notes: "Customer prefers automatic transmission"
              sendNotifications: true
      responses:
        '201':
          description: Reservation created successfully
          content:
            application/json:
              schema:
                $ref: '../shared/schemas/reservation.yaml#/CreateEmployeeReservationResponse'
              example:
                reservation:
                  id: "tcrn:reservation:aabbccdd-1122-3344-5566-778899aabbcc"
                  confirmationCode: "ABC123XY"
                  status: "confirmed"
                  pickupDate: "2024-12-20T10:00:00Z"
                  returnDate: "2024-12-27T10:00:00Z"
                  driver:
                    firstName: "Jan"
                    lastName: "Kowalski"
                    email: "jan.kowalski@example.com"
                    phone: "+48 123 456 789"
                    termsAccepted: true
                  vehicle:
                    id: "tcrn:vehicle:3fa85f64-5717-4562-b3fc-2c963f66afa6"
                    make: "Toyota"
                    model: "RAV4"
                    year: 2023
                    vehicleType: "suv"
                    transmission: "automatic"
                    fuelType: "hybrid"
                    seats: 5
                    mainImage: "https://cdn.example.com/vehicles/rav4.jpg"
                  branch:
                    id: "tcrn:branch:22222222-2222-2222-2222-222222222222"
                    name: "Warsaw Downtown"
                    city: "Warsaw"
                    address: "ul. Marszałkowska 100, 00-001 Warszawa"
                    phone: "+48 22 123 4567"
                  company:
                    id: "tcrn:company:11111111-1111-1111-1111-111111111111"
                    name: "Warsaw Premium Rentals"
                    email: "contact@warsawpremium.pl"
                  totalPrice: 175000
                  currency: "PLN"
                  pricingBreakdown:
                    rentalDays: 7
                    appliedTier: "premium"
                    effectiveDailyRate: 25000
                    dailyRateTotal: 175000
                    totalPrice: 175000
                    savings: 0
                    savingsPercent: 0
                  notes: "Customer prefers automatic transmission"
                  createdAt: "2024-12-15T10:00:00Z"
                confirmationCode: "ABC123XY"
                message: "Reservation created successfully"

        '400':
          description: Bad request - invalid input data
          content:
            application/json:
              schema:
                $ref: '../shared/schemas/common.yaml#/ErrorResponse'
              examples:
                invalidDates:
                  summary: Invalid date range
                  value:
                    message: "Return date must be after pickup date"
                    status: 400
                    timestamp: "2024-12-15T10:00:00Z"
                pastDate:
                  summary: Pickup date in the past
                  value:
                    message: "Pickup date cannot be in the past"
                    status: 400
                    timestamp: "2024-12-15T10:00:00Z"

        '401':
          description: Unauthorized - invalid or missing authentication
          content:
            application/json:
              schema:
                $ref: '../shared/schemas/common.yaml#/ErrorResponse'

        '403':
          description: Forbidden - vehicle belongs to different company
          content:
            application/json:
              schema:
                $ref: '../shared/schemas/common.yaml#/ErrorResponse'
              example:
                message: "Cannot create reservation for vehicle not owned by your company"
                status: 403
                timestamp: "2024-12-15T10:00:00Z"

        '404':
          description: Vehicle not found
          content:
            application/json:
              schema:
                $ref: '../shared/schemas/common.yaml#/ErrorResponse'
              example:
                message: "Vehicle not found: tcrn:vehicle:3fa85f64-5717-4562-b3fc-2c963f66afa6"
                status: 404
                timestamp: "2024-12-15T10:00:00Z"

        '409':
          description: Conflict - vehicle has overlapping active reservations
          content:
            application/json:
              schema:
                $ref: '../shared/schemas/common.yaml#/ErrorResponse'
              example:
                message: "Vehicle is not available for the requested dates"
                status: 409
                timestamp: "2024-12-15T10:00:00Z"

        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: '../shared/schemas/common.yaml#/ErrorResponse'

  /reservations/{reservationId}:
    get:
      tags:
        - Reservations
      summary: Get reservation details
      description: |
        Retrieve detailed information about a specific reservation.
        Only accessible for reservations belonging to the authenticated company.
      operationId: getCompanyReservation
      parameters:
        - name: reservationId
          in: path
          required: true
          description: Unique identifier of the reservation
          schema:
            $ref: '../shared/schemas/common.yaml#/ReservationId'

      responses:
        '200':
          description: Reservation details retrieved successfully
          content:
            application/json:
              schema:
                $ref: '../shared/schemas/reservation.yaml#/ReservationDetails'
              example:
                id: "tcrn:reservation:aabbccdd-1122-3344-5566-778899aabbcc"
                status: "pending"
                pickupDate: "2024-12-20T10:00:00Z"
                returnDate: "2024-12-27T10:00:00Z"
                driver:
                  firstName: "Jan"
                  lastName: "Kowalski"
                  email: "jan.kowalski@example.com"
                  phone: "+48 123 456 789"
                  termsAccepted: true
                vehicle:
                  id: "tcrn:vehicle:3fa85f64-5717-4562-b3fc-2c963f66afa6"
                  make: "Toyota"
                  model: "RAV4"
                  year: 2023
                  vehicleType: "suv"
                  transmission: "automatic"
                  fuelType: "hybrid"
                  seats: 5
                  pricePerDay: 250.00
                  currency: "PLN"
                  mainImage: "https://cdn.example.com/vehicles/rav4.jpg"
                branch:
                  id: "tcrn:branch:22222222-2222-2222-2222-222222222222"
                  name: "Warsaw Downtown"
                  city: "Warsaw"
                  address: "ul. Marszałkowska 1"
                company:
                  id: "tcrn:company:11111111-1111-1111-1111-111111111111"
                  name: "Rent-A-Car Poland"
                totalPrice: 1750.00
                currency: "PLN"
                notes: "Please have the car ready with a child seat"
                expiresAt: "2024-12-16T10:00:00Z"
                createdAt: "2024-12-15T10:00:00Z"

        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '../shared/schemas/common.yaml#/ErrorResponse'

        '403':
          description: Forbidden - reservation does not belong to the authenticated company
          content:
            application/json:
              schema:
                $ref: '../shared/schemas/common.yaml#/ErrorResponse'
              example:
                error: "Forbidden"
                message: "Reservation does not belong to your company"
                timestamp: "2024-11-15T12:00:00Z"

        '404':
          description: Reservation not found
          content:
            application/json:
              schema:
                $ref: '../shared/schemas/common.yaml#/ErrorResponse'
              example:
                error: "Not Found"
                message: "Reservation not found"
                timestamp: "2024-11-15T12:00:00Z"

        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: '../shared/schemas/common.yaml#/ErrorResponse'

  /reservations/{reservationId}/status:
    patch:
      tags:
        - Reservations
      summary: Update reservation status
      description: |
        Update the status of a reservation.

        **Allowed status transitions:**
        - pending → confirmed (accept the reservation)
        - pending → rejected (decline the reservation, must provide reason)
        - confirmed → completed (rental period ended successfully)
        - confirmed → no_show (customer did not pick up the vehicle)

        **Notes:**
        - When rejecting, you must provide a rejectionReason
        - Confirmed reservations should be marked as completed or no_show after the rental period
      operationId: updateReservationStatus
      parameters:
        - name: reservationId
          in: path
          required: true
          description: Unique identifier of the reservation
          schema:
            $ref: '../shared/schemas/common.yaml#/ReservationId'

      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '../shared/schemas/reservation.yaml#/UpdateReservationStatusRequest'
            examples:
              confirm:
                summary: Confirm reservation
                value:
                  status: "confirmed"
              reject:
                summary: Reject reservation
                value:
                  status: "rejected"
                  rejectionReason: "Vehicle is no longer available for the requested dates"
              complete:
                summary: Mark as completed
                value:
                  status: "completed"
              noShow:
                summary: Mark as no-show
                value:
                  status: "no_show"

      responses:
        '200':
          description: Status updated successfully
          content:
            application/json:
              schema:
                $ref: '../shared/schemas/reservation.yaml#/UpdateReservationStatusResponse'
              example:
                message: "Reservation confirmed successfully"
                reservation:
                  id: "tcrn:reservation:aabbccdd-1122-3344-5566-778899aabbcc"
                  status: "confirmed"
                  pickupDate: "2024-12-20T10:00:00Z"
                  returnDate: "2024-12-27T10:00:00Z"

        '400':
          description: Bad request - invalid status transition or missing rejection reason
          content:
            application/json:
              schema:
                $ref: '../shared/schemas/common.yaml#/ErrorResponse'
              examples:
                invalidTransition:
                  summary: Invalid status transition
                  value:
                    error: "Bad Request"
                    message: "Cannot transition from 'cancelled' to 'confirmed'"
                    timestamp: "2024-11-15T12:00:00Z"
                missingReason:
                  summary: Missing rejection reason
                  value:
                    error: "Bad Request"
                    message: "Rejection reason is required when rejecting a reservation"
                    timestamp: "2024-11-15T12:00:00Z"

        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '../shared/schemas/common.yaml#/ErrorResponse'

        '403':
          description: Forbidden - reservation does not belong to the authenticated company
          content:
            application/json:
              schema:
                $ref: '../shared/schemas/common.yaml#/ErrorResponse'

        '404':
          description: Reservation not found
          content:
            application/json:
              schema:
                $ref: '../shared/schemas/common.yaml#/ErrorResponse'

        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: '../shared/schemas/common.yaml#/ErrorResponse'

  /reservations/{reservationId}/modification:
    patch:
      tags:
        - Reservations
      summary: Approve or reject modification request
      description: |
        Respond to a customer's reservation modification request.
        Only applicable when the reservation status is 'modification_pending'.

        **Actions:**
        - Approve: Accept the requested changes (status returns to 'confirmed')
        - Reject: Decline the changes (status returns to 'confirmed' with original dates)

        The customer will be notified of the decision via email.
      operationId: handleModificationRequest
      parameters:
        - name: reservationId
          in: path
          required: true
          description: Unique identifier of the reservation
          schema:
            $ref: '../shared/schemas/common.yaml#/ReservationId'

      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '../shared/schemas/reservation.yaml#/ApproveModificationRequest'
            examples:
              approve:
                summary: Approve modification
                value:
                  approved: true
              reject:
                summary: Reject modification
                value:
                  approved: false
                  rejectionReason: "Vehicle is not available for the new dates"

      responses:
        '200':
          description: Modification request processed successfully
          content:
            application/json:
              schema:
                $ref: '../shared/schemas/reservation.yaml#/ApproveModificationResponse'
              example:
                message: "Modification approved successfully"
                reservation:
                  id: "tcrn:reservation:aabbccdd-1122-3344-5566-778899aabbcc"
                  status: "confirmed"
                  pickupDate: "2024-12-21T10:00:00Z"
                  returnDate: "2024-12-28T10:00:00Z"

        '400':
          description: Bad request - reservation is not in modification_pending status
          content:
            application/json:
              schema:
                $ref: '../shared/schemas/common.yaml#/ErrorResponse'
              examples:
                notPending:
                  summary: Not in modification pending status
                  value:
                    error: "Bad Request"
                    message: "Reservation is not pending modification approval"
                    timestamp: "2024-11-15T12:00:00Z"
                missingReason:
                  summary: Missing rejection reason
                  value:
                    error: "Bad Request"
                    message: "Rejection reason is required when declining a modification"
                    timestamp: "2024-11-15T12:00:00Z"

        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '../shared/schemas/common.yaml#/ErrorResponse'

        '403':
          description: Forbidden - reservation does not belong to the authenticated company
          content:
            application/json:
              schema:
                $ref: '../shared/schemas/common.yaml#/ErrorResponse'

        '404':
          description: Reservation not found
          content:
            application/json:
              schema:
                $ref: '../shared/schemas/common.yaml#/ErrorResponse'

        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: '../shared/schemas/common.yaml#/ErrorResponse'

  /reservations/{reservationId}/cancel:
    post:
      tags:
        - Reservations
      summary: Cancel a reservation
      description: |
        Cancel a customer's reservation.

        **Allowed from statuses:**
        - phone_verification_pending
        - pending
        - confirmed
        - modification_pending

        **Not allowed from:**
        - cancelled (already cancelled)
        - rejected (not active)
        - completed (finished)
        - no_show (finished)

        The customer will be notified via email about the cancellation.
      operationId: cancelReservation
      parameters:
        - name: reservationId
          in: path
          required: true
          description: Unique identifier of the reservation
          schema:
            $ref: '../shared/schemas/common.yaml#/ReservationId'

      requestBody:
        required: false
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CancelReservationRequest'
            example:
              reason: "Vehicle is no longer available for the requested dates"

      responses:
        '200':
          description: Reservation cancelled successfully
          content:
            application/json:
              schema:
                $ref: '../shared/schemas/reservation.yaml#/CancelReservationResponse'
              example:
                message: "Reservation cancelled successfully"
                reservation:
                  id: "tcrn:reservation:aabbccdd-1122-3344-5566-778899aabbcc"
                  status: "cancelled"
                  cancelledBy: "company"
                  cancelledAt: "2024-12-15T14:30:00Z"
                  cancellationReason: "Vehicle is no longer available for the requested dates"

        '409':
          description: Conflict - cannot cancel reservation in current status
          content:
            application/json:
              schema:
                $ref: '../shared/schemas/common.yaml#/ErrorResponse'
              examples:
                alreadyCancelled:
                  summary: Already cancelled
                  value:
                    status: 409
                    error: "Conflict"
                    errorCode: "CONFLICT"
                    message: "Reservation cannot be cancelled in status: cancelled"
                    timestamp: "2024-11-15T12:00:00Z"
                cannotCancel:
                  summary: Cannot cancel from current status
                  value:
                    status: 409
                    error: "Conflict"
                    errorCode: "CONFLICT"
                    message: "Reservation cannot be cancelled in status: completed"
                    timestamp: "2024-11-15T12:00:00Z"

        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '../shared/schemas/common.yaml#/ErrorResponse'

        '403':
          description: Forbidden - reservation does not belong to the authenticated company
          content:
            application/json:
              schema:
                $ref: '../shared/schemas/common.yaml#/ErrorResponse'

        '404':
          description: Reservation not found
          content:
            application/json:
              schema:
                $ref: '../shared/schemas/common.yaml#/ErrorResponse'

        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: '../shared/schemas/common.yaml#/ErrorResponse'

components:
  # Company-specific response schemas
  schemas:
    CompanyVehiclesResponse:
      type: object
      required:
        - vehicles
        - pagination
      properties:
        vehicles:
          type: array
          items:
            $ref: '../shared/schemas/vehicle.yaml#/VehicleBase'
          description: List of vehicles from the company
        pagination:
          $ref: '../shared/schemas/common.yaml#/PaginationInfo'

    CancelReservationRequest:
      type: object
      properties:
        reason:
          type: string
          maxLength: 500
          description: Optional reason for cancelling the reservation
          example: "Vehicle is no longer available for the requested dates"

  securitySchemes:
    bearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT
      description: JWT token for company authentication

security:
  - bearerAuth: []
